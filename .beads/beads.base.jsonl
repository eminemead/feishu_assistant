{"id":"feishu_assistant-2am","content_hash":"7ebf65c1d4ea78e6e5fb349005b6fd860ed152add12492417068e1e373694552","title":"Add test coverage for placeholder agents (alignment, P\u0026L, DPA PM)","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-11-20T17:42:59.674561+08:00","updated_at":"2025-11-20T17:42:59.674561+08:00","source_repo":"."}
{"id":"feishu_assistant-411","content_hash":"4902d95aab69aa22db2c0c8205c9050761eacf82c274c3ced776888e0b250a4e","title":"Create /history/ directory for AI-generated planning documents","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-20T17:28:14.568586+08:00","updated_at":"2025-11-20T17:28:14.568586+08:00","source_repo":"."}
{"id":"feishu_assistant-520","content_hash":"984027f1d29618493a0f3f611b5bd36a4e74f454da604eb1f82eeece931f2892","title":"Organize documentation into /docs/ folder structure","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-20T17:28:09.797215+08:00","updated_at":"2025-11-20T17:28:09.797215+08:00","source_repo":"."}
{"id":"feishu_assistant-61u","content_hash":"96bbbd8fb3fb134694413a5a38a25384065e03e16074adf03f8029e52a1b9dda","title":"Debug: Feishu cardElement.create API validation - action element with buttons returning 99992402","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-21T11:48:06.309793+08:00","updated_at":"2025-11-21T12:19:48.869161+08:00","closed_at":"2025-11-21T12:19:48.869161+08:00","source_repo":".","dependencies":[{"issue_id":"feishu_assistant-61u","depends_on_id":"feishu_assistant-6i7","type":"discovered-from","created_at":"2025-11-21T11:48:06.31093+08:00","created_by":"daemon"}]}
{"id":"feishu_assistant-6i7","content_hash":"ff323abaa9952c318c170d87e39b3b8dea692ddee6dd0a93ef93b20a339d8b45","title":"Suggestion cards not showing after response completes - finalizeCardWithFollowups not executing","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-20T19:36:22.215347+08:00","updated_at":"2025-11-21T12:05:44.497486+08:00","closed_at":"2025-11-21T12:05:44.497486+08:00","source_repo":"."}
{"id":"feishu_assistant-6od","content_hash":"e8def652d1c25d09a69d13d3ed3f819d06538f497502fc7f99e650d7f73cdd7e","title":"Wire StarRocks RLS truth table","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-25T17:13:01.668771+08:00","updated_at":"2025-11-25T17:13:01.668771+08:00","source_repo":"."}
{"id":"feishu_assistant-7xv","content_hash":"b78af36e9a8161664465f8b5cc2cb73cc6f8dac28cdb61114067cdd91ac34f38","title":"Implement card action handling for interactive card buttons","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T17:38:01.920402+08:00","updated_at":"2025-11-20T17:47:34.568098+08:00","closed_at":"2025-11-20T17:47:34.568098+08:00","source_repo":"."}
{"id":"feishu_assistant-8t6","content_hash":"f01b521c526e5a223f406f13c64fe785d74812b12acd7eba75bb4d8120d6f48e","title":"Text-based follow-up suggestions implementation in progress - debugging LLM generation and streaming mode issues","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-21T12:41:05.1981+08:00","updated_at":"2025-11-21T12:48:08.708269+08:00","closed_at":"2025-11-21T12:48:08.708269+08:00","source_repo":".","dependencies":[{"issue_id":"feishu_assistant-8t6","depends_on_id":"feishu_assistant-kjl","type":"discovered-from","created_at":"2025-11-21T12:41:05.198934+08:00","created_by":"daemon"}]}
{"id":"feishu_assistant-9im","content_hash":"ffbae63e1dde4f450e44184468d767b849d95f2ff681273f638a5a7579f5a688","title":"Server startup failures and WebSocket connection issues - ROOT PROBLEM","description":"## PROBLEM STATEMENT\n\nServer startup and WebSocket connection has been unstable throughout development sessions. The root cause has not been properly diagnosed or fixed. We need to systematically identify and resolve the underlying issues.\n\n## WHAT WE'VE OBSERVED\n\n1. **Intermittent Startup Failures**: Server sometimes starts successfully, sometimes hangs\n2. **WebSocket Connection Issues**: Connection appears to establish but reliability is uncertain\n3. **Long Debugging Sessions**: We've spent extended time testing buttons, checking logs, restarting servers without identifying the root cause\n4. **Manual Workarounds**: We're using nohup, pid files, sleep commands - signs of working around problems rather than fixing them\n\n## IMPACT\n\n- Cannot reliably start the server for testing\n- Unclear if production deployment will have similar issues\n- Development velocity severely impacted by restarts and debugging\n- No clear diagnostic tools to understand what's happening\n\n## AREAS TO INVESTIGATE\n\n### 1. Server Startup Process\n- [ ] Check if initial WebSocket connection is blocking server startup\n- [ ] Look at initialization order in server.ts\n- [ ] Verify all dependencies are loaded before listening on port 3000\n- [ ] Check for race conditions in async initialization\n\n### 2. WebSocket Connection Handling\n- [ ] Verify Feishu SDK setup and initialization\n- [ ] Check if event-dispatch is fully ready before accepting events\n- [ ] Look at error handling for failed connections\n- [ ] Determine if WebSocket reconnection logic is working\n\n### 3. Environment and Dependencies\n- [ ] Verify Supabase is optional or gracefully skipped\n- [ ] Check if missing env vars are properly handled\n- [ ] Review all external service dependencies\n\n### 4. Logging and Diagnostics\n- [ ] Add detailed startup phase logging\n- [ ] Log WebSocket lifecycle events (connecting, connected, reconnecting, failed)\n- [ ] Add health check endpoint that shows detailed status\n- [ ] Log timing information to identify bottlenecks\n\n## ACCEPTANCE CRITERIA\n\n- [ ] Server starts reliably 100% of the time (no hangs, no race conditions)\n- [ ] WebSocket connection status is clearly visible in logs\n- [ ] Health endpoint shows detailed startup and connection status\n- [ ] Can diagnose connection failures without inspecting code\n- [ ] Startup time is documented and predictable (\u003c10s)\n\n## TECHNICAL NOTES\n\n- Current startup code in server.ts appears to initialize WebSocket and Feishu SDK\n- Subscription Mode is being used (long-lived WebSocket instead of webhook polling)\n- There's a 5-8 second wait in AGENTS.md noted as \"startup time\" but actual behavior varies\n- No explicit timeout handling for WebSocket connection establishment\n\n## NEXT STEPS\n\n1. Add detailed logging to server.ts startup sequence\n2. Create startup verification tests\n3. Document expected startup phases and timing\n4. Add explicit error handling for connection failures\n5. Verify all startup warnings can be safely ignored","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-20T19:01:22.366615+08:00","updated_at":"2025-11-20T19:03:55.023249+08:00","closed_at":"2025-11-20T19:03:55.023249+08:00","source_repo":"."}
{"id":"feishu_assistant-9ls","content_hash":"ac6d4398d825500c2f1e5bb670beb38fde74d5e72501f4e57dd92e140115688a","title":"Server startup still slow or failing - investigate and fix","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-20T18:45:22.439447+08:00","updated_at":"2025-11-20T18:53:34.933763+08:00","closed_at":"2025-11-20T18:53:34.933763+08:00","source_repo":"."}
{"id":"feishu_assistant-aps","content_hash":"365b0d6d231ebfa04f0bb86ff4654d882f406f769844b2767fcf0de453abe9b0","title":"Investigate and fix socket connection reset in threading","description":"","status":"open","priority":2,"issue_type":"bug","created_at":"2025-11-20T17:42:50.02121+08:00","updated_at":"2025-11-20T17:42:50.02121+08:00","source_repo":"."}
{"id":"feishu_assistant-eeb","content_hash":"7fca47a85fb3000df96b26fb220f052f9d142e8dd26612b56214b2a38b0c9dd9","title":"Buttons fail with sequence number error - separate sequence counters conflict","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-20T19:23:43.043973+08:00","updated_at":"2025-11-20T19:25:35.678357+08:00","closed_at":"2025-11-20T19:25:35.678357+08:00","source_repo":"."}
{"id":"feishu_assistant-f15","content_hash":"7e30bb698a622e8e8a0d39456a83d5a62d927c67e2b848bd70e6be2b9db31efa","title":"Establish code style conventions for implementation docs","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-20T17:28:28.811304+08:00","updated_at":"2025-11-20T17:28:28.811304+08:00","source_repo":"."}
{"id":"feishu_assistant-grr","content_hash":"191ce5c7c2828b6393183cbcf210c9865ba9e250bd8d9a7af956b3a13bf9cc23","title":"Investigate alternative button UI approaches - blocked by Feishu API constraint","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-21T13:17:00.242215+08:00","updated_at":"2025-11-21T13:17:00.242215+08:00","source_repo":".","dependencies":[{"issue_id":"feishu_assistant-grr","depends_on_id":"feishu_assistant-ujn","type":"discovered-from","created_at":"2025-11-21T13:17:00.243207+08:00","created_by":"daemon"}]}
{"id":"feishu_assistant-ibe","content_hash":"2f0e5937777981c76a63259970b78a806ff8a1660084b677622e1c26cc3b2d98","title":"Render follow-up options as interactive buttons on Feishu cards","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T17:52:34.153059+08:00","updated_at":"2025-11-20T18:01:45.996325+08:00","closed_at":"2025-11-20T18:01:45.996325+08:00","source_repo":".","dependencies":[{"issue_id":"feishu_assistant-ibe","depends_on_id":"feishu_assistant-xx9","type":"discovered-from","created_at":"2025-11-20T17:52:34.153636+08:00","created_by":"daemon"}]}
{"id":"feishu_assistant-k5h","content_hash":"1fb7a34022d3330303d1cb5d66b9a60e4a7f98d0b457ea358bbcffcc311417a3","title":"Fix TypeScript deep type recursion workarounds","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-20T17:42:40.184363+08:00","updated_at":"2025-11-20T17:42:40.184363+08:00","source_repo":"."}
{"id":"feishu_assistant-kjl","content_hash":"8571eac95bf2e4f13607e2dc77e7a6bf057dac5f27e78b4fe2d8b60d7a107a3c","title":"Alternative UI for follow-up suggestions - text-based menu or markdown links","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-21T12:05:54.322503+08:00","updated_at":"2025-11-21T12:29:35.998215+08:00","closed_at":"2025-11-21T12:29:35.998215+08:00","source_repo":".","dependencies":[{"issue_id":"feishu_assistant-kjl","depends_on_id":"feishu_assistant-61u","type":"discovered-from","created_at":"2025-11-21T12:05:54.323503+08:00","created_by":"daemon"}]}
{"id":"feishu_assistant-kug","content_hash":"e688b4e0b36a94f7b875e46dad4156b963b8e1a8dac490d15d0d7d383b9e3c34","title":"Buttons feature not fully working - multiple implementation issues","description":"","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-11-20T19:27:28.804228+08:00","updated_at":"2025-11-21T14:39:18.331564+08:00","closed_at":"2025-11-21T14:39:18.331564+08:00","source_repo":"."}
{"id":"feishu_assistant-l39","content_hash":"0126545640881a5d256b549403806f1af6aeb444d9dcb0ded8e87c64ad75405f","title":"Integrate chart streaming into OKR reviewer agent","description":"Wire up chart generation tool and OKR streaming functions into the OKR reviewer agent.\n\n## What's Ready\n- chartGenerationTool (Mermaid \u0026 Vega-Lite builders)\n- streamComprehensiveOKRAnalysis() (queries real okr_metrics.db)\n- All code tested with real OKR data (47 companies, 10月 period)\n\n## Work to Do\n1. Add chartGenerationTool to OKR agent's tools array\n2. Import streamComprehensiveOKRAnalysis in agent\n3. Update agent system prompt to mention chart capability\n4. Test end-to-end with Feishu query\n5. Verify charts stream and render\n\n## Implementation Details\n- File: lib/agents/okr-reviewer-agent.ts\n- Add tool import and to tools array\n- Update instructions to use charts for visualization requests\n- Test with: 'OKR分析和图表' or 'Show OKR charts'\n\n## Expected Outcome\n- User queries 'OKR分析' → Gets response with streaming bar chart + pie chart + insights\n- Charts show real data from okr_metrics.db\n- Markdown streams progressively with typewriter effect\n\n## Blockers\n- None (all dependencies ready)\n\n## Notes\n- Related: streamOKRCompanyAnalysis(), streamOKRMetricTypeAnalysis() also available\n- See: lib/okr-chart-streaming.ts for implementation\n- See: NEXT_SESSION_CHARTS_INTEGRATION.md for context","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-21T16:49:26.785071+08:00","updated_at":"2025-11-21T16:49:37.438813+08:00","source_repo":"."}
{"id":"feishu_assistant-lu3","content_hash":"dc09e5770a849e193e9fc539f5b189cf4f84568a40fbdbd3c2b208b2c00b9115","title":"Debug and fix OKR chart generation in Feishu","description":"","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-11-21T17:25:12.579221+08:00","updated_at":"2025-11-21T17:25:17.930203+08:00","source_repo":"."}
{"id":"feishu_assistant-m6l","content_hash":"41ee46679b5c8da392d41169ac1e6e03f7cd8c65720e0483036464001fafdde0","title":"Handle rate limiting for free LLM models (kwaipilot 429 errors)","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-20T17:42:45.434957+08:00","updated_at":"2025-11-25T17:48:43.356241+08:00","closed_at":"2025-11-25T17:48:43.356241+08:00","source_repo":"."}
{"id":"feishu_assistant-o07","content_hash":"fbcffa7829a6b99c8e1a0370314703255c8df43f082cd1c501398021e61fed25","title":"Buttons not rendering in conversation - finalizeCardWithFollowups not being called","description":"","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-11-20T19:15:21.972151+08:00","updated_at":"2025-11-25T17:48:43.615706+08:00","closed_at":"2025-11-25T17:48:43.615706+08:00","source_repo":"."}
{"id":"feishu_assistant-s5p","content_hash":"21916435d8d372a3ee3c8e19214e69a846f62c74a60cd7eff64a8e8c96d7fba2","title":"Investigate alternative button UI approaches - blocked by Feishu API constraint","description":"","status":"in_progress","priority":1,"issue_type":"task","created_at":"2025-11-21T13:17:07.909345+08:00","updated_at":"2025-11-21T14:09:17.884629+08:00","source_repo":".","dependencies":[{"issue_id":"feishu_assistant-s5p","depends_on_id":"feishu_assistant-ujn","type":"discovered-from","created_at":"2025-11-21T13:17:07.909943+08:00","created_by":"daemon"}]}
{"id":"feishu_assistant-su1","content_hash":"f725b1416e1ad883de5993f7af4a51db828edcea6b735c9dd414790bf2acde94","title":"Handle button selection and feed back to agent as new query","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T17:52:41.652186+08:00","updated_at":"2025-11-20T18:18:01.330625+08:00","closed_at":"2025-11-20T18:18:01.330625+08:00","source_repo":".","dependencies":[{"issue_id":"feishu_assistant-su1","depends_on_id":"feishu_assistant-ibe","type":"discovered-from","created_at":"2025-11-20T17:52:41.652959+08:00","created_by":"daemon"}]}
{"id":"feishu_assistant-ujn","content_hash":"fd18c1ee1a42f676730ad83d37f8b54d93df8b862968633c9015ba78eb2e6775","title":"Implement real suggestion button UIs in assistant chat for direct interaction","description":"","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-21T12:51:43.762052+08:00","updated_at":"2025-11-21T13:15:03.078967+08:00","closed_at":"2025-11-21T13:15:03.078967+08:00","source_repo":"."}
{"id":"feishu_assistant-v8r","content_hash":"01b9630c02127d0a1cab5e779c4b0e1a9ee42a0162929d2859fdeed5709de908","title":"Update .gitignore to exclude /history/ directory","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-20T17:28:19.527161+08:00","updated_at":"2025-11-20T17:28:19.527161+08:00","source_repo":"."}
{"id":"feishu_assistant-xx9","content_hash":"73d0cb8c1d703310aee94e6f5a0eef63d0d6def8d1a3785fac174bfc6acfc8b2","title":"Generate follow-up questions/recommendations for agent responses","description":"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-20T17:52:24.167953+08:00","updated_at":"2025-11-20T17:58:56.119663+08:00","closed_at":"2025-11-20T17:58:56.119663+08:00","source_repo":"."}
{"id":"feishu_assistant-zba","content_hash":"00aec7b89c159ca8a1c8dfdc55fda9bbfbaa69c814b4e6f01168dd846456a7cf","title":"Text repeats in response cards - streaming update sending accumulated text instead of delta","description":"","status":"open","priority":1,"issue_type":"bug","created_at":"2025-11-20T19:21:23.657755+08:00","updated_at":"2025-11-20T19:21:23.657755+08:00","source_repo":"."}
