$ bun server.ts
[info]: [ "client ready" ]
âš ï¸ [Auth] Supabase URL or ANON_KEY not configured. RLS features will be disabled.
âš ï¸ [Auth] SUPABASE_JWT_SECRET not configured. JWT generation will fail.
âš ï¸ [Auth] Supabase credentials not configured. RLS features will be disabled.
[info]: [ "event-dispatch is ready" ]
ğŸ“‹ [Startup] Starting server initialization...
ğŸ“‹ [Startup] Mode: Subscription (WebSocket)
ğŸ“‹ [Startup] Step 1: Initializing WebSocket connection...
[info]: [ "[ws]", "receive events or callbacks through persistent connection only available in self-build & Feishu app, Configured in:\n        Developer Console(å¼€å‘è€…åå°) \n          ->\n        Events and Callbacks(äº‹ä»¶ä¸å›è°ƒ)\n          -> \n        Mode of event/callback subscription(è®¢é˜…æ–¹å¼)\n          -> \n        Receive events/callbacks through persistent connection(ä½¿ç”¨ é•¿è¿æ¥ æ¥æ”¶äº‹ä»¶/å›è°ƒ)" ]
âœ… [Startup] Step 1: WebSocket connection established
ğŸ“‹ [Startup] Ready to receive Feishu events
ğŸ“‹ [Startup] Step 2: Starting HTTP server...
âœ… [Startup] Step 2: HTTP server started on port 3000
âœ¨ [Startup] Server is ready to accept requests
ğŸ“Š [Startup] Health check: curl http://localhost:3000/health
[info]: [ "[ws]", "ws client ready" ]
ğŸ“¨ [WebSocket] Event received: im.message.receive_v1
ğŸ“¨ [WebSocket] Event data: {
  "schema": "2.0",
  "event_id": "de86faa39bf5e0f91068401674953671",
  "token": "",
  "create_time": "1763697828395",
  "event_type": "im.message.receive_v1",
  "tenant_key": "2de1f662118f575d",
  "app_id": "cli_a6af6b76c6f0d013",
  "message": {
    "chat_id": "oc_cd4b98905e12ec0cb68adc529440e623",
    "chat_type": "group",
    "content": "{\"text\":\"@_user_1 è¿˜æœ‰åˆ«çš„ä¹ˆ\"}",
    "create_time": "1763697828118",
    "mentions": [
      {
        "id": {
          "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
          "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
          "user_id": ""
        },
        "key": "@_user_1",
        "name": "Evi",
        "tenant_key": "2de1f662118f575d"
      }
    ],
    "message_id": "om_x100b5eca048dcca8c3eb2adf48c9fe1",
    "message_type": "text",
    "parent_id": "om_x100b5edb3c20e4a0c291114d498450e",
    "root_id": "om_x100b5edb3c20e4a0c291114d498450e",
    "thread_id": "omt_1a7b7fe7f08f1b85",
    "update_time": "1763697828169",
    "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 15_3_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.6778.268 Safari/537.36 Lark/7.56.5 LarkLocale/zh_CN ttnet SDK-Version/7.56.19"
  },
  "sender": {
    "sender_id": {
      "open_id": "ou_db4d1d08c4fcd3f1f4c253eab32ff580",
      "union_id": "on_80d62273b85f0904e27382a59cc1f730",
      "user_id": "xiaofei.yin"
    },
    "sender_type": "user",
    "tenant_key": "2de1f662118f575d"
  }
}
ğŸ¤– [WebSocket] Bot User ID: cli_a6af6b76c6f0d013
ğŸ‘¤ [Auth] Extracted user ID: ou_db4d1d08c4fcd3f1f4c253eab32ff580
ğŸ“© [WebSocket] Message details: chatId=oc_cd4b98905e12ec0cb68adc529440e623, messageId=om_x100b5eca048dcca8c3eb2adf48c9fe1, chatType=group
ğŸ” [WebSocket] Mentions array: [
  {
    "id": {
      "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
      "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
      "user_id": ""
    },
    "key": "@_user_1",
    "name": "Evi",
    "tenant_key": "2de1f662118f575d"
  }
]
ğŸ” [WebSocket] Found 1 mention(s) in group message
âœ… [WebSocket] Bot mention detected via mentions array
ğŸ‘¥ [WebSocket] Processing group mention: "@_user_1 è¿˜æœ‰åˆ«çš„ä¹ˆ..."
Handling app mention
ğŸ“¤ [Card] Creating and sending streaming card to chat_id:oc_cd4b98905e12ec0cb68adc529440e623
âœ… [Card] Created streaming card: cardId=7575024492742118628, elementId=md_97828496
ğŸ“¨ [Card] Sending card message with cardId: 7575024492742118628
ğŸ“¨ [Card] Sending as thread reply to message: om_x100b5eca048dcca8c3eb2adf48c9fe1
âœ… [Card] Card sent successfully: messageId=om_x100b5eca049c10a0c3b4acd7440c648, cardId=7575024492742118628
[Thread] Fetching thread history: rootId=om_x100b5edb3c20e4a0c291114d498450e, messageId=om_x100b5eca048dcca8c3eb2adf48c9fe1
âŒ Failed to fetch thread after 1 attempt: Thread fetch timeout after 5000ms
âš ï¸ Proceeding with empty thread context (falling back to current message only)
âš ï¸ [Thread] Thread history empty or fetch failed, using current message only
[Thread] Fallback: Starting fresh with current message only
[Thread] Processing with 1 message(s)
[FeishuMention] Generating response...
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using fallback model: Google Gemini 2.5 Flash (Paid (reliable, no rate limits))
[Manager] Received query: "@_user_1 è¿˜æœ‰åˆ«çš„ä¹ˆ"
[Manager] Starting stream for query: "@_user_1 è¿˜æœ‰åˆ«çš„ä¹ˆ" with primary model
[Manager] Memory context: conversationId=feishu:oc_cd4b98905e12ec0cb68adc529440e623:om_x100b5edb3c20e4a0c291114d498450e, userId=user:ou_db4d1d08c4fcd3f1f4c253eab32ff580, feishuUserId=ou_db4d1d08c4fcd3f1f4c253eab32ff580
[Manager] Stream created, starting to read textStream...
[Cache] MISS
[Cache] MISS
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=1, contentLength=2
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=2, contentLength=52
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=3, contentLength=103
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=4, contentLength=153
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=5, contentLength=194
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=6, contentLength=203
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=7, contentLength=253
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=8, contentLength=306
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=9, contentLength=338
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=10, contentLength=390
ğŸ”„ [Card] Updating card element: cardId=7575024492742118628, elementId=md_97828496, sequence=11, contentLength=410
[Manager] Finished reading textStream. Total chunks: 210, Final text length: 410
[Manager] Final result received: {
  text: "N/A",
  textLength: 0,
  accumulatedLength: 410,
  usage: {
    input: undefined,
    output: undefined,
    total: undefined,
  },
}
[Manager] Query handled directly (no handoff): "@_user_1 è¿˜æœ‰åˆ«çš„ä¹ˆ"
[Manager] Returning final text (length=410)
[FeishuMention] Response generated (length=410): "ç›®å‰æˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ä½ä¸“ä¸šä»£ç†å¯ä»¥ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼š

## ğŸ¯ OKR Reviewer
- **ä¸“é•¿*..."
[FeishuMention] About to finalize card with followups. cardId=7575024492742118628, result length=410
ğŸ¯ [CardButtons] Finalizing card with follow-ups: cardId=7575024492742118628, contentLength=410
ğŸ¯ [CardButtons] Calling finalizeCardSettings...
ğŸ¯ [CardButtons] finalizeCardSettings completed
ğŸ¯ [CardButtons] About to generate followup questions. finalContent="ç›®å‰æˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ä½ä¸“ä¸šä»£ç†å¯ä»¥ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼š

## ğŸ¯ OKR Reviewer
- **ä¸“é•¿*...", context="@_user_1 è¿˜æœ‰åˆ«çš„ä¹ˆ..."
ğŸ”„ [Followups] Generating 3 follow-up questions for response: "ç›®å‰æˆ‘ä»¬æœ‰ä»¥ä¸‹å‡ ä½ä¸“ä¸šä»£ç†å¯ä»¥ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼š

## ğŸ¯ OKR Reviewer
- **ä¸“é•¿*..."
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
âš ï¸ [WebSocket] Duplicate event ignored: de86faa39bf5e0f91068401674953671
âŒ [Followups] Error generating follow-ups: 154 | 3. Encourage deeper exploration or next steps
155 | 
156 | Return exactly ${maxOptions} follow-ups as JSON array.`,
157 |     });
158 | 
159 |     const followups = result.followups.slice(0, maxOptions);
                                   ^
TypeError: undefined is not an object (evaluating '(await generateObject({
      model,
      schema: z.object({
        followups: z.array(z.object({
          text: z.string().max(60),
          type: z.enum(["question", "recommendation", "action"]),
          rationale: z.string().optional()
        }))
      }),
      prompt: `Based on this agent response, generate ${maxOptions} thoughtful follow-up questions or recommendations that users might want to explore next.

Agent Response: "${response}"
${context ? `
Context: ${context}` : ""}

Each follow-up should be:
1. Concise (max 60 characters - must fit on a button)
2. Actionable and relevant to the response
3. Encourage deeper exploration or next steps

Return exactly ${maxOptions} follow-ups as JSON array.`
    })).followups.slice')
      at generateFollowupQuestions (/Users/xiaofei.yin/work_repo/feishu_assistant/lib/tools/generate-followups-tool.ts:159:30)

ğŸ¯ [CardButtons] generateFollowupQuestions returned 3 followups
ğŸ¯ [CardButtons] About to add 3 followup buttons...
ğŸ“Œ [CardButtons] addFollowupButtons called with Feishu client
ğŸ“Œ [CardButtons] Feishu client ready: object, has cardkit: true
ğŸ“Œ [CardButtons] Client verification passed, proceeding with adding buttons
ğŸ“Œ [CardButtons] Adding 3 button elements to card: cardId=7575024492742118628
ğŸ“Œ [CardButtons] Attempting to add buttons using card.update with patches...
[error]: [
  [
    {
      message: "Request failed with status code 400",
      config: [Object ...],
      request: [Object ...],
      response: [Object ...],
    }, {
      code: 99992402,
      msg: "field validation failed",
      error: [Object ...],
      log_id: "202511211204134AA3565A8A7E5345CDA5",
      troubleshooter: "æ’æŸ¥å»ºè®®æŸ¥çœ‹(Troubleshooting suggestions): https://open.feishu.cn/search?from=openapi&log_id=202511211204134AA3565A8A7E5345CDA5&code=99992402&method_id=7355916510231298050",
      field_violations: [
        [Object ...]
      ],
    }
  ]
]
âš ï¸ [CardButtons] Error adding follow-up buttons (non-critical): AxiosError {
  message: "Request failed with status code 400",
  name: "AxiosError",
  code: "ERR_BAD_REQUEST",
  config: {
    transitional: {
      silentJSONParsing: true,
      forcedJSONParsing: true,
      clarifyTimeoutError: false,
    },
    adapter: [Function: httpAdapter],
    transformRequest: [
      [Function: transformRequest]
    ],
    transformResponse: [
      [Function: transformResponse]
    ],
    timeout: 0,
    xsrfCookieName: "XSRF-TOKEN",
    xsrfHeaderName: "X-XSRF-TOKEN",
    maxContentLength: -1,
    maxBodyLength: -1,
    env: {
      FormData: [Function: FormData],
    },
    validateStatus: [Function: validateStatus],
    headers: {
      Accept: "application/json, text/plain, */*",
      "Content-Type": "application/json",
      "User-Agent": "oapi-node-sdk/1.0.0",
      Authorization: "Bearer t-g104blaXNAKMFPZX2ZDVKEPAZ5T3473XY7LBXV5T",
      "Content-Length": 522,
    },
    url: "https://open.feishu.cn/open-apis/cardkit/v1/cards/7575024492742118628",
    method: "put",
    data: "{\"patches\":[{\"op\":\"add\",\"path\":\"/body/elements/-\",\"value\":{\"tag\":\"div\",\"fields\":[{\"tag\":\"action\",\"actions\":[{\"tag\":\"button\",\"text\":{\"content\":\"Tell me more\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"Tell me more\"},{\"tag\":\"button\",\"text\":{\"content\":\"How do I apply this?\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"How do I apply this?\"},{\"tag\":\"button\",\"text\":{\"content\":\"What's next?\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"What's next?\"}]}]}}],\"sequence\":13}",
    params: {},
    paramsSerializer: [Function: paramsSerializer],
  },
  request: ClientRequest {
    write: [Function],
    end: [Function],
    flushHeaders: [Function],
    destroy: [Function],
    _ensureTls: [Function],
    abort: [Function],
    [Symbol(tls)]: null,
    [Symbol(kAbortController)]: AbortController {
      signal: [AbortSignal ...],
      abort: [Function: abort],
    },
    [Symbol(agent)]: Agent {
      _events: [Object ...],
      _eventsCount: 0,
      _maxListeners: undefined,
      [Symbol(kCapture)]: false,
      defaultPort: 443,
      protocol: "https:",
      options: [Object ...],
      requests: [Object ...],
      sockets: [Object ...],
      freeSockets: [Object ...],
      keepAliveMsecs: 1000,
      keepAlive: true,
      maxSockets: Infinity,
      maxFreeSockets: 256,
      scheduling: "lifo",
      maxTotalSockets: undefined,
      totalSocketCount: 0,
      maxCachedSessions: 100,
      createConnection: undefined,
      getName: [Function],
      addRequest: [Function],
      createSocket: [Function],
      removeSocket: [Function],
      keepSocketAlive: [Function],
      reuseSocket: [Function],
      destroy: [Function],
      setMaxListeners: [Function: setMaxListeners],
      getMaxListeners: [Function: getMaxListeners],
      emit: [Function: emit],
      addListener: [Function: addListener],
      on: [Function: addListener],
      prependListener: [Function: prependListener],
      once: [Function: once],
      prependOnceListener: [Function: prependOnceListener],
      removeListener: [Function: removeListener],
      off: [Function: removeListener],
      removeAllListeners: [Function: removeAllListeners],
      listeners: [Function: listeners],
      rawListeners: [Function: rawListeners],
      listenerCount: [Function: listenerCount],
      eventNames: [Function: eventNames],
    },
    destroyed: false,
    [Symbol(protocol)]: "https:",
    [Symbol(port)]: 443,
    [Symbol(useDefaultPort)]: true,
    [Symbol(host)]: "open.feishu.cn",
    [Symbol(socketPath)]: undefined,
    [Symbol(method)]: "PUT",
    maxHeaderSize: undefined,
    [Symbol(maxHeaderSize)]: undefined,
    insecureHTTPParser: undefined,
    joinDuplicateHeaders: undefined,
    [Symbol(path)]: "/open-apis/cardkit/v1/cards/7575024492742118628",
    _events: [Object: null prototype] {
      abort: [
        [Function]
      ],
      aborted: [
        [Function]
      ],
      connect: [
        [Function]
      ],
      error: [
        [Function]
      ],
      socket: [
        [Function]
      ],
      timeout: [
        [Function]
      ],
    },
    _eventsCount: 6,
    finished: true,
    [Symbol(res)]: null,
    [Symbol(upgradeOrConnect)]: false,
    [Symbol(parser)]: null,
    [Symbol(maxHeadersCount)]: null,
    [Symbol(reusedSocket)]: false,
    [Symbol(headers)]: Headers {
      "accept": "application/json, text/plain, */*",
      "content-type": "application/json",
      "user-agent": "oapi-node-sdk/1.0.0",
      "authorization": "Bearer t-g104blaXNAKMFPZX2ZDVKEPAZ5T3473XY7LBXV5T",
      "content-length": "522",
    },
    [Symbol(options)]: {
      maxRedirects: 21,
      maxBodyLength: 10485760,
      protocol: "https:",
      path: "/open-apis/cardkit/v1/cards/7575024492742118628",
      method: "PUT",
      headers: [Object ...],
      agent: undefined,
      agents: [Object ...],
      auth: undefined,
      hostname: "open.feishu.cn",
      port: null,
      nativeProtocols: [Object ...],
      pathname: "/open-apis/cardkit/v1/cards/7575024492742118628",
      _defaultAgent: [Object ...],
      host: "open.feishu.cn",
    },
    _httpMessage: [Circular],
    [Symbol(emitState)]: 14,
    setSocketKeepAlive: [Function],
    setNoDelay: [Function],
    [Symbol(kClearTimeout)]: [Function],
    _redirectable: Writable {
      _events: [Object ...],
      _writableState: [Object ...],
      _maxListeners: undefined,
      [Symbol(kCapture)]: false,
      _options: [Object ...],
      _ended: true,
      _ending: true,
      _redirectCount: 0,
      _redirects: [],
      _requestBodyLength: 522,
      _requestBodyBuffers: [],
      _eventsCount: NaN,
      _onNativeResponse: [Function],
      _currentRequest: [Circular],
      _currentUrl: "https://open.feishu.cn/open-apis/cardkit/v1/cards/7575024492742118628",
      abort: [Function],
      destroy: [Function],
      write: [Function],
      end: [Function],
      setHeader: [Function],
      removeHeader: [Function],
      setTimeout: [Function],
      flushHeaders: [Function],
      getHeader: [Function],
      setNoDelay: [Function],
      setSocketKeepAlive: [Function],
      aborted: [Getter],
      connection: [Getter],
      socket: [Getter],
      _sanitizeOptions: [Function],
      _performRequest: [Function],
      _processResponse: [Function],
      pipe: [Function],
      cork: [Function],
      uncork: [Function],
      setDefaultEncoding: [Function: setDefaultEncoding],
      _write: [Function],
      _writev: null,
      closed: [Getter],
      destroyed: [Getter/Setter],
      writable: [Getter/Setter],
      writableFinished: [Getter],
      writableObjectMode: [Getter],
      writableBuffer: [Getter],
      writableEnded: [Getter],
      writableNeedDrain: [Getter],
      writableHighWaterMark: [Getter],
      writableCorked: [Getter],
      writableLength: [Getter],
      errored: [Getter],
      writableAborted: [Getter],
      _undestroy: [Function: undestroy],
      _destroy: [Function],
      [Symbol(nodejs.rejection)]: [Function],
      [Symbol(Symbol.asyncDispose)]: [Function],
      eventNames: [Function: eventNames],
      setMaxListeners: [Function: setMaxListeners],
      getMaxListeners: [Function: getMaxListeners],
      emit: [Function: emit],
      addListener: [Function: addListener],
      on: [Function: addListener],
      prependListener: [Function: prependListener],
      once: [Function: once],
      prependOnceListener: [Function: prependOnceListener],
      removeListener: [Function: removeListener],
      off: [Function: removeListener],
      removeAllListeners: [Function: removeAllListeners],
      listeners: [Function: listeners],
      rawListeners: [Function: rawListeners],
      listenerCount: [Function: listenerCount],
    },
    [Symbol(bodyChunks)]: [
      <Buffer 7b 22 70 61 74 63 68 65 73 22 3a 5b 7b 22 6f 70 22 3a 22 61 64 64 22 2c 22 70 61 74 68 22 3a 22 2f 62 6f 64 79 2f 65 6c 65 6d 65 6e 74 73 2f 2d 22 2c ... 472 more bytes>
    ],
    [Symbol(fetchRequest)]: null,
    [Symbol(fakeSocket)]: Socket {
      _events: [Object ...],
      _readableState: [Object ...],
      _writableState: [Object ...],
      allowHalfOpen: true,
      _maxListeners: undefined,
      [Symbol(kCapture)]: false,
      [Symbol(::bunternal::)]: undefined,
      bytesRead: 0,
      bytesWritten: 0,
      connecting: false,
      timeout: 0,
      isServer: false,
      _httpMessage: [Circular],
      _onTimeout: [Function],
      address: [Function: address],
      bufferSize: [Getter],
      connect: [Function: connect],
      _destroy: [Function: _destroy],
      _final: [Function: _final],
      localAddress: [Getter],
      localFamily: [Getter],
      localPort: [Getter],
      pending: [Getter],
      _read: [Function: _read],
      readyState: [Getter],
      ref: [Function: ref],
      remoteAddress: [Getter/Setter],
      remotePort: [Getter/Setter],
      remoteFamily: [Getter/Setter],
      resetAndDestroy: [Function: resetAndDestroy],
      setKeepAlive: [Function: setKeepAlive],
      setNoDelay: [Function: setNoDelay],
      setTimeout: [Function: setTimeout],
      unref: [Function: unref],
      _write: [Function: _write],
      destroy: [Function: destroy],
      write: [Function],
      cork: [Function],
      uncork: [Function],
      setDefaultEncoding: [Function: setDefaultEncoding],
      _writev: null,
      end: [Function],
      writable: [Getter/Setter],
      writableHighWaterMark: [Getter],
      writableObjectMode: [Getter],
      writableBuffer: [Getter],
      writableLength: [Getter],
      writableFinished: [Getter],
      writableCorked: [Getter],
      writableEnded: [Getter],
      writableNeedDrain: [Getter],
      destroyed: [Getter/Setter],
      _undestroy: [Function: undestroy],
      push: [Function],
      unshift: [Function],
      isPaused: [Function],
      setEncoding: [Function],
      read: [Function],
      pipe: [Function],
      unpipe: [Function],
      on: [Function],
      addListener: [Function],
      removeListener: [Function],
      off: [Function],
      removeAllListeners: [Function],
      resume: [Function],
      pause: [Function],
      wrap: [Function],
      iterator: [Function],
      readable: [Getter/Setter],
      readableDidRead: [Getter],
      readableAborted: [Getter],
      readableHighWaterMark: [Getter],
      readableBuffer: [Getter],
      readableFlowing: [Getter/Setter],
      readableLength: [Getter],
      readableObjectMode: [Getter],
      readableEncoding: [Getter],
      errored: [Getter],
      closed: [Getter],
      readableEnded: [Getter],
      drop: [Function],
      filter: [Function],
      flatMap: [Function],
      map: [Function],
      take: [Function],
      compose: [Function],
      every: [Function],
      forEach: [Function],
      reduce: [Function],
      toArray: [Function],
      some: [Function],
      find: [Function],
      [Symbol(nodejs.rejection)]: [Function],
      [Symbol(Symbol.asyncDispose)]: [Function],
      [Symbol(Symbol.asyncIterator)]: [Function],
      eventNames: [Function: eventNames],
    },
    res: IncomingMessage {
      [Symbol(aborted)]: false,
      [Symbol(eofInProgress)]: true,
      _consuming: true,
      _dumped: false,
      complete: true,
      _closed: false,
      [Symbol(noBody)]: false,
      _events: [Object ...],
      _readableState: [Object ...],
      _maxListeners: undefined,
      [Symbol(kCapture)]: false,
      _eventsCount: NaN,
      [Symbol(FetchAPI)]: Response (0 KB) {
        ok: false,
        url: "https://open.feishu.cn/open-apis/cardkit/v1/cards/7575024492742118628",
        status: 400,
        statusText: "Bad Request",
        headers: Headers [Object ...],
        redirected: false,
        bodyUsed: true
      },
      [Symbol(type)]: 1,
      [Symbol(bodyStream)]: undefined,
      [Symbol(statusMessage)]: "Bad Request",
      [Symbol(statusCode)]: 400,
      url: "/open-apis/cardkit/v1/cards/7575024492742118628",
      headers: [Object ...],
      rawHeaders: [
        "content-type", "application/json; charset=utf-8", "content-length", "373", "connection",
        "keep-alive", "date", "Fri, 21 Nov 2025 04:04:13 GMT", "server-timing", "inner; dur=11, cdn-cache;desc=MISS,edge;dur=0,origin;dur=40",
        "via", "cache2.cn7173[40,0]", "timing-allow-origin", "*", "Server", "Tengine", "X-Tt-Logid",
        "202511211204134AA3565A8A7E5345CDA5", "X-Lgw-Dst-Svc", "UiAprQch1G8grm_3wBzo9o6mxlbeG1r6WEC-FIU0-JM6R-ZkXnCxl0Zih02fTeP2f-TA3WOzGx6c5xEatalZz1U4BUYaeB1s04BxV36HCVi3THfZFpTJ5ScIHL8IITfmZXqnBXjTiNGMyczF55niw3OPVfL_kCtYVgtZzYjc9SimyQaObA_DUtMZO76A08yoRywrvPMETAO0ddqIiot73BltMAJzUs2msKtucqqgbHojyfllSCA=",
        "Tt_stable", "1", "X-Request-Id", "da90979c-ab17-4cca-9a6e-292a2228b386", "Request-Id",
        "da90979c-ab17-4cca-9a6e-292a2228b386", "x-tt-trace-host", "01f5563db8f7e8f46fe210cc28722285d5eeb7364d712c728ef6811599a5c2f5e62275160f1b07a642a0cd966464ea8bb5575b05d59ce1ecc0ba5f1012e968d5c600899b97fbedf202c0e587b4a6d9af138d2a0ed7fb1265f116dfe1b52755c709",
        "x-tt-trace-tag", "id=03;cdn-cache=miss;type=dyn", "x-tt-trace-id", "00-2511211204134AA3565A8A7E5345CDA5-09A8390B22ACB532-00",
        "X-Timestamp", "1763697853.357", "x-alicdn-da-ups-status", "endOs,0,400", "EagleId",
        "b4a3919617636978533277533e"
      ],
      [Symbol(fakeSocket)]: [Object ...],
      req: [Circular],
      setTimeout: [Function],
      responseUrl: "https://open.feishu.cn/open-apis/cardkit/v1/cards/7575024492742118628",
      redirects: [],
      [Symbol(kAutoDestroyed)]: true,
      httpVersion: "1.1",
      _construct: [Function: _construct],
      _dump: [Function: _dump],
      _read: [Function: _read],
      _finish: [Function: _finish],
      _destroy: [Function: IncomingMessage_destroy],
      aborted: [Getter/Setter],
      connection: [Getter],
      statusCode: [Getter/Setter],
      statusMessage: [Getter/Setter],
      httpVersionMajor: [Getter/Setter],
      httpVersionMinor: [Getter/Setter],
      rawTrailers: [Getter/Setter],
      trailers: [Getter/Setter],
      socket: [Getter/Setter],
      destroy: [Function: destroy],
      _undestroy: [Function: undestroy],
      push: [Function],
      unshift: [Function],
      isPaused: [Function],
      setEncoding: [Function],
      read: [Function],
      pipe: [Function],
      unpipe: [Function],
      on: [Function],
      addListener: [Function],
      removeListener: [Function],
      off: [Function],
      removeAllListeners: [Function],
      resume: [Function],
      pause: [Function],
      wrap: [Function],
      iterator: [Function],
      readable: [Getter/Setter],
      readableDidRead: [Getter],
      readableAborted: [Getter],
      readableHighWaterMark: [Getter],
      readableBuffer: [Getter],
      readableFlowing: [Getter/Setter],
      readableLength: [Getter],
      readableObjectMode: [Getter],
      readableEncoding: [Getter],
      errored: [Getter],
      closed: [Getter],
      destroyed: [Getter/Setter],
      readableEnded: [Getter],
      drop: [Function],
      filter: [Function],
      flatMap: [Function],
      map: [Function],
      take: [Function],
      compose: [Function],
      every: [Function],
      forEach: [Function],
      reduce: [Function],
      toArray: [Function],
      some: [Function],
      find: [Function],
      [Symbol(nodejs.rejection)]: [Function],
      [Symbol(Symbol.asyncDispose)]: [Function],
      [Symbol(Symbol.asyncIterator)]: [Function],
      eventNames: [Function: eventNames],
      setMaxListeners: [Function: setMaxListeners],
      getMaxListeners: [Function: getMaxListeners],
      emit: [Function: emit],
      prependListener: [Function: prependListener],
      once: [Function: once],
      prependOnceListener: [Function: prependOnceListener],
      listeners: [Function: listeners],
      rawListeners: [Function: rawListeners],
      listenerCount: [Function: listenerCount],
    },
    _closed: true,
    complete: true,
    setTimeout: [Function: setTimeout],
    clearTimeout: [Function: clearTimeout],
    path: [Getter],
    port: [Getter],
    method: [Getter],
    host: [Getter],
    protocol: [Getter],
    agent: [Getter/Setter],
    aborted: [Getter/Setter],
    writable: [Getter],
    _keepAliveTimeout: 0,
    _defaultKeepAlive: true,
    shouldKeepAlive: true,
    _onPendingData: [Function: nop2],
    outputSize: 0,
    outputData: [],
    strictContentLength: false,
    _removedTE: false,
    _removedContLen: false,
    _removedConnection: false,
    usesChunkedEncodingByDefault: true,
    _headerNames: [Getter/Setter],
    appendHeader: [Function: appendHeader],
    _implicitHeader: [Function: _implicitHeader],
    getHeader: [Function: getHeader],
    pipe: [Function: pipe],
    getHeaderNames: [Function: getHeaderNames],
    getRawHeaderNames: [Function: getRawHeaderNames],
    getHeaders: [Function: getHeaders],
    removeHeader: [Function: removeHeader],
    setHeader: [Function: setHeader],
    setHeaders: [Function: setHeaders],
    hasHeader: [Function: hasHeader],
    headers: [Getter/Setter],
    addTrailers: [Function: addTrailers],
    connection: [Getter/Setter],
    socket: [Getter/Setter],
    chunkedEncoding: [Getter/Setter],
    writableObjectMode: [Getter],
    writableLength: [Getter],
    writableHighWaterMark: [Getter],
    writableNeedDrain: [Getter],
    writableEnded: [Getter],
    writableFinished: [Getter],
    _send: [Function: _send],
    _writeRaw: [Function: _writeRaw],
    writableCorked: [Getter/Setter],
    cork: [Function: cork],
    uncork: [Function: uncork],
    _headers: [Getter/Setter],
    eventNames: [Function: eventNames],
    setMaxListeners: [Function: setMaxListeners],
    getMaxListeners: [Function: getMaxListeners],
    emit: [Function: emit],
    addListener: [Function: addListener],
    on: [Function: addListener],
    prependListener: [Function: prependListener],
    once: [Function: once],
    prependOnceListener: [Function: prependOnceListener],
    removeListener: [Function: removeListener],
    off: [Function: removeListener],
    removeAllListeners: [Function: removeAllListeners],
    listeners: [Function: listeners],
    rawListeners: [Function: rawListeners],
    listenerCount: [Function: listenerCount],
    [Symbol(kCapture)]: false,
  },
  response: {
    status: 400,
    statusText: "Bad Request",
    headers: {
      "content-type": "application/json; charset=utf-8",
      "content-length": "373",
      connection: "keep-alive",
      date: "Fri, 21 Nov 2025 04:04:13 GMT",
      "server-timing": "inner; dur=11, cdn-cache;desc=MISS,edge;dur=0,origin;dur=40",
      via: "cache2.cn7173[40,0]",
      "timing-allow-origin": "*",
      server: "Tengine",
      "x-tt-logid": "202511211204134AA3565A8A7E5345CDA5",
      "x-lgw-dst-svc": "UiAprQch1G8grm_3wBzo9o6mxlbeG1r6WEC-FIU0-JM6R-ZkXnCxl0Zih02fTeP2f-TA3WOzGx6c5xEatalZz1U4BUYaeB1s04BxV36HCVi3THfZFpTJ5ScIHL8IITfmZXqnBXjTiNGMyczF55niw3OPVfL_kCtYVgtZzYjc9SimyQaObA_DUtMZO76A08yoRywrvPMETAO0ddqIiot73BltMAJzUs2msKtucqqgbHojyfllSCA=",
      tt_stable: "1",
      "x-request-id": "da90979c-ab17-4cca-9a6e-292a2228b386",
      "request-id": "da90979c-ab17-4cca-9a6e-292a2228b386",
      "x-tt-trace-host": "01f5563db8f7e8f46fe210cc28722285d5eeb7364d712c728ef6811599a5c2f5e62275160f1b07a642a0cd966464ea8bb5575b05d59ce1ecc0ba5f1012e968d5c600899b97fbedf202c0e587b4a6d9af138d2a0ed7fb1265f116dfe1b52755c709",
      "x-tt-trace-tag": "id=03;cdn-cache=miss;type=dyn",
      "x-tt-trace-id": "00-2511211204134AA3565A8A7E5345CDA5-09A8390B22ACB532-00",
      "x-timestamp": "1763697853.357",
      "x-alicdn-da-ups-status": "endOs,0,400",
      eagleid: "b4a3919617636978533277533e",
    },
    config: {
      transitional: [Object ...],
      adapter: [Function: httpAdapter],
      transformRequest: [
        [Function: transformRequest]
      ],
      transformResponse: [
        [Function: transformResponse]
      ],
      timeout: 0,
      xsrfCookieName: "XSRF-TOKEN",
      xsrfHeaderName: "X-XSRF-TOKEN",
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object ...],
      validateStatus: [Function: validateStatus],
      headers: [Object ...],
      url: "https://open.feishu.cn/open-apis/cardkit/v1/cards/7575024492742118628",
      method: "put",
      data: "{\"patches\":[{\"op\":\"add\",\"path\":\"/body/elements/-\",\"value\":{\"tag\":\"div\",\"fields\":[{\"tag\":\"action\",\"actions\":[{\"tag\":\"button\",\"text\":{\"content\":\"Tell me more\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"Tell me more\"},{\"tag\":\"button\",\"text\":{\"content\":\"How do I apply this?\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"How do I apply this?\"},{\"tag\":\"button\",\"text\":{\"content\":\"What's next?\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"What's next?\"}]}]}}],\"sequence\":13}",
      params: [Object ...],
      paramsSerializer: [Function: paramsSerializer],
    },
    request: ClientRequest {
      write: [Function],
      end: [Function],
      flushHeaders: [Function],
      destroy: [Function],
      _ensureTls: [Function],
      abort: [Function],
      [Symbol(tls)]: null,
      [Symbol(kAbortController)]: [AbortController ...],
      [Symbol(agent)]: [Object ...],
      destroyed: false,
      [Symbol(protocol)]: "https:",
      [Symbol(port)]: 443,
      [Symbol(useDefaultPort)]: true,
      [Symbol(host)]: "open.feishu.cn",
      [Symbol(socketPath)]: undefined,
      [Symbol(method)]: "PUT",
      maxHeaderSize: undefined,
      [Symbol(maxHeaderSize)]: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      [Symbol(path)]: "/open-apis/cardkit/v1/cards/7575024492742118628",
      _events: [Object ...],
      _eventsCount: 6,
      finished: true,
      [Symbol(res)]: null,
      [Symbol(upgradeOrConnect)]: false,
      [Symbol(parser)]: null,
      [Symbol(maxHeadersCount)]: null,
      [Symbol(reusedSocket)]: false,
      [Symbol(headers)]: Headers [Object ...],
      [Symbol(options)]: [Object ...],
      _httpMessage: [Circular],
      [Symbol(emitState)]: 14,
      setSocketKeepAlive: [Function],
      setNoDelay: [Function],
      [Symbol(kClearTimeout)]: [Function],
      _redirectable: [Object ...],
      [Symbol(bodyChunks)]: [
        <Buffer 7b 22 70 61 74 63 68 65 73 22 3a 5b 7b 22 6f 70 22 3a 22 61 64 64 22 2c 22 70 61 74 68 22 3a 22 2f 62 6f 64 79 2f 65 6c 65 6d 65 6e 74 73 2f 2d 22 2c ... 472 more bytes>
      ],
      [Symbol(fetchRequest)]: null,
      [Symbol(fakeSocket)]: [Object ...],
      res: [Object ...],
      _closed: true,
      complete: true,
      setTimeout: [Function: setTimeout],
      clearTimeout: [Function: clearTimeout],
      path: [Getter],
      port: [Getter],
      method: [Getter],
      host: [Getter],
      protocol: [Getter],
      agent: [Getter/Setter],
      aborted: [Getter/Setter],
      writable: [Getter],
      _keepAliveTimeout: 0,
      _defaultKeepAlive: true,
      shouldKeepAlive: true,
      _onPendingData: [Function: nop2],
      outputSize: 0,
      outputData: [],
      strictContentLength: false,
      _removedTE: false,
      _removedContLen: false,
      _removedConnection: false,
      usesChunkedEncodingByDefault: true,
      _headerNames: [Getter/Setter],
      appendHeader: [Function: appendHeader],
      _implicitHeader: [Function: _implicitHeader],
      getHeader: [Function: getHeader],
      pipe: [Function: pipe],
      getHeaderNames: [Function: getHeaderNames],
      getRawHeaderNames: [Function: getRawHeaderNames],
      getHeaders: [Function: getHeaders],
      removeHeader: [Function: removeHeader],
      setHeader: [Function: setHeader],
      setHeaders: [Function: setHeaders],
      hasHeader: [Function: hasHeader],
      headers: [Getter/Setter],
      addTrailers: [Function: addTrailers],
      connection: [Getter/Setter],
      socket: [Getter/Setter],
      chunkedEncoding: [Getter/Setter],
      writableObjectMode: [Getter],
      writableLength: [Getter],
      writableHighWaterMark: [Getter],
      writableNeedDrain: [Getter],
      writableEnded: [Getter],
      writableFinished: [Getter],
      _send: [Function: _send],
      _writeRaw: [Function: _writeRaw],
      writableCorked: [Getter/Setter],
      cork: [Function: cork],
      uncork: [Function: uncork],
      _headers: [Getter/Setter],
      eventNames: [Function: eventNames],
      setMaxListeners: [Function: setMaxListeners],
      getMaxListeners: [Function: getMaxListeners],
      emit: [Function: emit],
      addListener: [Function: addListener],
      on: [Function: addListener],
      prependListener: [Function: prependListener],
      once: [Function: once],
      prependOnceListener: [Function: prependOnceListener],
      removeListener: [Function: removeListener],
      off: [Function: removeListener],
      removeAllListeners: [Function: removeAllListeners],
      listeners: [Function: listeners],
      rawListeners: [Function: rawListeners],
      listenerCount: [Function: listenerCount],
      [Symbol(kCapture)]: false,
    },
    data: {
      code: 99992402,
      msg: "field validation failed",
      error: [Object ...],
    },
  },
  toJSON: [Function: toJSON],
  isAxiosError: true,
  toString: [Function: toString],
}
ğŸ¯ [CardButtons] addFollowupButtons completed
âœ… [CardButtons] Card finalized with 3 follow-up buttons
[FeishuMention] Finalization result: {
  followups: [
    {
      text: "Tell me more",
      type: "question",
    }, {
      text: "How do I apply this?",
      type: "question",
    }, {
      text: "What's next?",
      type: "action",
    }
  ],
}
[error]: [
  [
    {
      message: "The socket connection was closed unexpectedly. For more information, pass `verbose: true` in the second argument to fetch()",
      config: [Object ...],
      request: [Object ...],
      response: [Object ...],
    }
  ]
]
ğŸ“¨ [WebSocket] Event received: im.message.receive_v1
ğŸ“¨ [WebSocket] Event data: {
  "schema": "2.0",
  "event_id": "dc7252d432e3d472d796c296e956216d",
  "token": "",
  "create_time": "1763699507492",
  "event_type": "im.message.receive_v1",
  "tenant_key": "2de1f662118f575d",
  "app_id": "cli_a6af6b76c6f0d013",
  "message": {
    "chat_id": "oc_cd4b98905e12ec0cb68adc529440e623",
    "chat_type": "group",
    "content": "{\"text\":\"@_user_1 Watch your new behavior\"}",
    "create_time": "1763699507205",
    "mentions": [
      {
        "id": {
          "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
          "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
          "user_id": ""
        },
        "key": "@_user_1",
        "name": "Evi",
        "tenant_key": "2de1f662118f575d"
      }
    ],
    "message_id": "om_x100b5ecafdfc5ca4c387cad2af2565d",
    "message_type": "text",
    "parent_id": "om_x100b5edb3c20e4a0c291114d498450e",
    "root_id": "om_x100b5edb3c20e4a0c291114d498450e",
    "thread_id": "omt_1a7b7fe7f08f1b85",
    "update_time": "1763699507205",
    "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 15_3_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.6778.268 Safari/537.36 Lark/7.56.5 LarkLocale/zh_CN ttnet SDK-Version/7.56.19"
  },
  "sender": {
    "sender_id": {
      "open_id": "ou_db4d1d08c4fcd3f1f4c253eab32ff580",
      "union_id": "on_80d62273b85f0904e27382a59cc1f730",
      "user_id": "xiaofei.yin"
    },
    "sender_type": "user",
    "tenant_key": "2de1f662118f575d"
  }
}
ğŸ¤– [WebSocket] Bot User ID: cli_a6af6b76c6f0d013
ğŸ‘¤ [Auth] Extracted user ID: ou_db4d1d08c4fcd3f1f4c253eab32ff580
ğŸ“© [WebSocket] Message details: chatId=oc_cd4b98905e12ec0cb68adc529440e623, messageId=om_x100b5ecafdfc5ca4c387cad2af2565d, chatType=group
ğŸ” [WebSocket] Mentions array: [
  {
    "id": {
      "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
      "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
      "user_id": ""
    },
    "key": "@_user_1",
    "name": "Evi",
    "tenant_key": "2de1f662118f575d"
  }
]
ğŸ” [WebSocket] Found 1 mention(s) in group message
âœ… [WebSocket] Bot mention detected via mentions array
ğŸ‘¥ [WebSocket] Processing group mention: "@_user_1 Watch your new behavior..."
Handling app mention
ğŸ“¤ [Card] Creating and sending streaming card to chat_id:oc_cd4b98905e12ec0cb68adc529440e623
âœ… [Card] Created streaming card: cardId=7575031704667475124, elementId=md_99507596
ğŸ“¨ [Card] Sending card message with cardId: 7575031704667475124
ğŸ“¨ [Card] Sending as thread reply to message: om_x100b5ecafdfc5ca4c387cad2af2565d
âœ… [Card] Card sent successfully: messageId=om_x100b5ecafd8fd0a0c377162804cbca0, cardId=7575031704667475124
[Thread] Fetching thread history: rootId=om_x100b5edb3c20e4a0c291114d498450e, messageId=om_x100b5ecafdfc5ca4c387cad2af2565d
âŒ Failed to fetch thread after 1 attempt: Thread fetch timeout after 5000ms
âš ï¸ Proceeding with empty thread context (falling back to current message only)
âš ï¸ [Thread] Thread history empty or fetch failed, using current message only
[Thread] Fallback: Starting fresh with current message only
[Thread] Processing with 1 message(s)
[FeishuMention] Generating response...
[Manager] Received query: "@_user_1 Watch your new behavior"
[Manager] Starting stream for query: "@_user_1 Watch your new behavior" with primary model
[Manager] Memory context: conversationId=feishu:oc_cd4b98905e12ec0cb68adc529440e623:om_x100b5edb3c20e4a0c291114d498450e, userId=user:ou_db4d1d08c4fcd3f1f4c253eab32ff580, feishuUserId=ou_db4d1d08c4fcd3f1f4c253eab32ff580
[Manager] Stream created, starting to read textStream...
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=1, contentLength=1
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=2, contentLength=52
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=3, contentLength=107
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=4, contentLength=162
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=5, contentLength=212
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=6, contentLength=262
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=7, contentLength=312
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=8, contentLength=366
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=9, contentLength=416
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=10, contentLength=466
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=11, contentLength=518
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=12, contentLength=574
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=13, contentLength=589
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=14, contentLength=592
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=15, contentLength=653
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=16, contentLength=708
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=17, contentLength=763
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=18, contentLength=813
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=19, contentLength=865
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=20, contentLength=915
ğŸ”„ [Card] Updating card element: cardId=7575031704667475124, elementId=md_99507596, sequence=21, contentLength=946
[Manager] Finished reading textStream. Total chunks: 221, Final text length: 946
[Manager] Final result received: {
  text: "N/A",
  textLength: 0,
  accumulatedLength: 946,
  usage: {
    input: undefined,
    output: undefined,
    total: undefined,
  },
}
[Manager] Query handled directly (no handoff): "@_user_1 Watch your new behavior"
[Manager] Returning final text (length=946)
[FeishuMention] Response generated (length=946): "I understand you're referring to my new behavior. ..."
[FeishuMention] About to finalize card with followups. cardId=7575031704667475124, result length=946
ğŸ¯ [CardButtons] Finalizing card with follow-ups: cardId=7575031704667475124, contentLength=946
ğŸ¯ [CardButtons] Calling finalizeCardSettings...
ğŸ¯ [CardButtons] finalizeCardSettings completed
ğŸ¯ [CardButtons] About to generate followup questions. finalContent="I understand you're referring to my new behavior. ...", context="@_user_1 Watch your new behavi..."
ğŸ”„ [Followups] Generating 3 follow-up questions for response: "I understand you're referring to my new behavior. ..."
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
âš ï¸ [WebSocket] Duplicate event ignored: dc7252d432e3d472d796c296e956216d
âŒ [Followups] Error generating follow-ups: 154 | 3. Encourage deeper exploration or next steps
155 | 
156 | Return exactly ${maxOptions} follow-ups as JSON array.`,
157 |     });
158 | 
159 |     const followups = result.followups.slice(0, maxOptions);
                                   ^
TypeError: undefined is not an object (evaluating '(await generateObject({
      model,
      schema: z.object({
        followups: z.array(z.object({
          text: z.string().max(60),
          type: z.enum(["question", "recommendation", "action"]),
          rationale: z.string().optional()
        }))
      }),
      prompt: `Based on this agent response, generate ${maxOptions} thoughtful follow-up questions or recommendations that users might want to explore next.

Agent Response: "${response}"
${context ? `
Context: ${context}` : ""}

Each follow-up should be:
1. Concise (max 60 characters - must fit on a button)
2. Actionable and relevant to the response
3. Encourage deeper exploration or next steps

Return exactly ${maxOptions} follow-ups as JSON array.`
    })).followups.slice')
      at generateFollowupQuestions (/Users/xiaofei.yin/work_repo/feishu_assistant/lib/tools/generate-followups-tool.ts:159:30)

ğŸ¯ [CardButtons] generateFollowupQuestions returned 3 followups
ğŸ¯ [CardButtons] About to add 3 followup buttons...
ğŸ“Œ [CardButtons] addFollowupButtons called with Feishu client
ğŸ“Œ [CardButtons] Feishu client ready: object, has cardkit: true
ğŸ“Œ [CardButtons] Client verification passed, proceeding with adding buttons
ğŸ“Œ [CardButtons] Adding 3 button elements to card: cardId=7575031704667475124
ğŸ“Œ [CardButtons] Attempting to add buttons using card.update with patches...
[error]: [
  [
    {
      message: "Request failed with status code 400",
      config: [Object ...],
      request: [Object ...],
      response: [Object ...],
    }, {
      code: 99992402,
      msg: "field validation failed",
      error: [Object ...],
      log_id: "20251121123208C6E69B35C6B4404DF635",
      troubleshooter: "æ’æŸ¥å»ºè®®æŸ¥çœ‹(Troubleshooting suggestions): https://open.feishu.cn/search?from=openapi&log_id=20251121123208C6E69B35C6B4404DF635&code=99992402&method_id=7355916510231298050",
      field_violations: [
        [Object ...]
      ],
    }
  ]
]
âš ï¸ [CardButtons] Error adding follow-up buttons (non-critical): AxiosError {
  message: "Request failed with status code 400",
  name: "AxiosError",
  code: "ERR_BAD_REQUEST",
  config: {
    transitional: {
      silentJSONParsing: true,
      forcedJSONParsing: true,
      clarifyTimeoutError: false,
    },
    adapter: [Function: httpAdapter],
    transformRequest: [
      [Function: transformRequest]
    ],
    transformResponse: [
      [Function: transformResponse]
    ],
    timeout: 0,
    xsrfCookieName: "XSRF-TOKEN",
    xsrfHeaderName: "X-XSRF-TOKEN",
    maxContentLength: -1,
    maxBodyLength: -1,
    env: {
      FormData: [Function: FormData],
    },
    validateStatus: [Function: validateStatus],
    headers: {
      Accept: "application/json, text/plain, */*",
      "Content-Type": "application/json",
      "User-Agent": "oapi-node-sdk/1.0.0",
      Authorization: "Bearer t-g104blaXNAKMFPZX2ZDVKEPAZ5T3473XY7LBXV5T",
      "Content-Length": 522,
    },
    url: "https://open.feishu.cn/open-apis/cardkit/v1/cards/7575031704667475124",
    method: "put",
    data: "{\"patches\":[{\"op\":\"add\",\"path\":\"/body/elements/-\",\"value\":{\"tag\":\"div\",\"fields\":[{\"tag\":\"action\",\"actions\":[{\"tag\":\"button\",\"text\":{\"content\":\"Tell me more\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"Tell me more\"},{\"tag\":\"button\",\"text\":{\"content\":\"How do I apply this?\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"How do I apply this?\"},{\"tag\":\"button\",\"text\":{\"content\":\"What's next?\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"What's next?\"}]}]}}],\"sequence\":23}",
    params: {},
    paramsSerializer: [Function: paramsSerializer],
  },
  request: ClientRequest {
    write: [Function],
    end: [Function],
    flushHeaders: [Function],
    destroy: [Function],
    _ensureTls: [Function],
    abort: [Function],
    [Symbol(tls)]: null,
    [Symbol(kAbortController)]: AbortController {
      signal: [AbortSignal ...],
      abort: [Function: abort],
    },
    [Symbol(agent)]: Agent {
      _events: [Object ...],
      _eventsCount: 0,
      _maxListeners: undefined,
      [Symbol(kCapture)]: false,
      defaultPort: 443,
      protocol: "https:",
      options: [Object ...],
      requests: [Object ...],
      sockets: [Object ...],
      freeSockets: [Object ...],
      keepAliveMsecs: 1000,
      keepAlive: true,
      maxSockets: Infinity,
      maxFreeSockets: 256,
      scheduling: "lifo",
      maxTotalSockets: undefined,
      totalSocketCount: 0,
      maxCachedSessions: 100,
      createConnection: undefined,
      getName: [Function],
      addRequest: [Function],
      createSocket: [Function],
      removeSocket: [Function],
      keepSocketAlive: [Function],
      reuseSocket: [Function],
      destroy: [Function],
      setMaxListeners: [Function: setMaxListeners],
      getMaxListeners: [Function: getMaxListeners],
      emit: [Function: emit],
      addListener: [Function: addListener],
      on: [Function: addListener],
      prependListener: [Function: prependListener],
      once: [Function: once],
      prependOnceListener: [Function: prependOnceListener],
      removeListener: [Function: removeListener],
      off: [Function: removeListener],
      removeAllListeners: [Function: removeAllListeners],
      listeners: [Function: listeners],
      rawListeners: [Function: rawListeners],
      listenerCount: [Function: listenerCount],
      eventNames: [Function: eventNames],
    },
    destroyed: false,
    [Symbol(protocol)]: "https:",
    [Symbol(port)]: 443,
    [Symbol(useDefaultPort)]: true,
    [Symbol(host)]: "open.feishu.cn",
    [Symbol(socketPath)]: undefined,
    [Symbol(method)]: "PUT",
    maxHeaderSize: undefined,
    [Symbol(maxHeaderSize)]: undefined,
    insecureHTTPParser: undefined,
    joinDuplicateHeaders: undefined,
    [Symbol(path)]: "/open-apis/cardkit/v1/cards/7575031704667475124",
    _events: [Object: null prototype] {
      abort: [
        [Function]
      ],
      aborted: [
        [Function]
      ],
      connect: [
        [Function]
      ],
      error: [
        [Function]
      ],
      socket: [
        [Function]
      ],
      timeout: [
        [Function]
      ],
    },
    _eventsCount: 6,
    finished: true,
    [Symbol(res)]: null,
    [Symbol(upgradeOrConnect)]: false,
    [Symbol(parser)]: null,
    [Symbol(maxHeadersCount)]: null,
    [Symbol(reusedSocket)]: false,
    [Symbol(headers)]: Headers {
      "accept": "application/json, text/plain, */*",
      "content-type": "application/json",
      "user-agent": "oapi-node-sdk/1.0.0",
      "authorization": "Bearer t-g104blaXNAKMFPZX2ZDVKEPAZ5T3473XY7LBXV5T",
      "content-length": "522",
    },
    [Symbol(options)]: {
      maxRedirects: 21,
      maxBodyLength: 10485760,
      protocol: "https:",
      path: "/open-apis/cardkit/v1/cards/7575031704667475124",
      method: "PUT",
      headers: [Object ...],
      agent: undefined,
      agents: [Object ...],
      auth: undefined,
      hostname: "open.feishu.cn",
      port: null,
      nativeProtocols: [Object ...],
      pathname: "/open-apis/cardkit/v1/cards/7575031704667475124",
      _defaultAgent: [Object ...],
      host: "open.feishu.cn",
    },
    _httpMessage: [Circular],
    [Symbol(emitState)]: 14,
    setSocketKeepAlive: [Function],
    setNoDelay: [Function],
    [Symbol(kClearTimeout)]: [Function],
    _redirectable: Writable {
      _events: [Object ...],
      _writableState: [Object ...],
      _maxListeners: undefined,
      [Symbol(kCapture)]: false,
      _options: [Object ...],
      _ended: true,
      _ending: true,
      _redirectCount: 0,
      _redirects: [],
      _requestBodyLength: 522,
      _requestBodyBuffers: [],
      _eventsCount: NaN,
      _onNativeResponse: [Function],
      _currentRequest: [Circular],
      _currentUrl: "https://open.feishu.cn/open-apis/cardkit/v1/cards/7575031704667475124",
      abort: [Function],
      destroy: [Function],
      write: [Function],
      end: [Function],
      setHeader: [Function],
      removeHeader: [Function],
      setTimeout: [Function],
      flushHeaders: [Function],
      getHeader: [Function],
      setNoDelay: [Function],
      setSocketKeepAlive: [Function],
      aborted: [Getter],
      connection: [Getter],
      socket: [Getter],
      _sanitizeOptions: [Function],
      _performRequest: [Function],
      _processResponse: [Function],
      pipe: [Function],
      cork: [Function],
      uncork: [Function],
      setDefaultEncoding: [Function: setDefaultEncoding],
      _write: [Function],
      _writev: null,
      closed: [Getter],
      destroyed: [Getter/Setter],
      writable: [Getter/Setter],
      writableFinished: [Getter],
      writableObjectMode: [Getter],
      writableBuffer: [Getter],
      writableEnded: [Getter],
      writableNeedDrain: [Getter],
      writableHighWaterMark: [Getter],
      writableCorked: [Getter],
      writableLength: [Getter],
      errored: [Getter],
      writableAborted: [Getter],
      _undestroy: [Function: undestroy],
      _destroy: [Function],
      [Symbol(nodejs.rejection)]: [Function],
      [Symbol(Symbol.asyncDispose)]: [Function],
      eventNames: [Function: eventNames],
      setMaxListeners: [Function: setMaxListeners],
      getMaxListeners: [Function: getMaxListeners],
      emit: [Function: emit],
      addListener: [Function: addListener],
      on: [Function: addListener],
      prependListener: [Function: prependListener],
      once: [Function: once],
      prependOnceListener: [Function: prependOnceListener],
      removeListener: [Function: removeListener],
      off: [Function: removeListener],
      removeAllListeners: [Function: removeAllListeners],
      listeners: [Function: listeners],
      rawListeners: [Function: rawListeners],
      listenerCount: [Function: listenerCount],
    },
    [Symbol(bodyChunks)]: [
      <Buffer 7b 22 70 61 74 63 68 65 73 22 3a 5b 7b 22 6f 70 22 3a 22 61 64 64 22 2c 22 70 61 74 68 22 3a 22 2f 62 6f 64 79 2f 65 6c 65 6d 65 6e 74 73 2f 2d 22 2c ... 472 more bytes>
    ],
    [Symbol(fetchRequest)]: null,
    [Symbol(fakeSocket)]: Socket {
      _events: [Object ...],
      _readableState: [Object ...],
      _writableState: [Object ...],
      allowHalfOpen: true,
      _maxListeners: undefined,
      [Symbol(kCapture)]: false,
      [Symbol(::bunternal::)]: undefined,
      bytesRead: 0,
      bytesWritten: 0,
      connecting: false,
      timeout: 0,
      isServer: false,
      _httpMessage: [Circular],
      _onTimeout: [Function],
      address: [Function: address],
      bufferSize: [Getter],
      connect: [Function: connect],
      _destroy: [Function: _destroy],
      _final: [Function: _final],
      localAddress: [Getter],
      localFamily: [Getter],
      localPort: [Getter],
      pending: [Getter],
      _read: [Function: _read],
      readyState: [Getter],
      ref: [Function: ref],
      remoteAddress: [Getter/Setter],
      remotePort: [Getter/Setter],
      remoteFamily: [Getter/Setter],
      resetAndDestroy: [Function: resetAndDestroy],
      setKeepAlive: [Function: setKeepAlive],
      setNoDelay: [Function: setNoDelay],
      setTimeout: [Function: setTimeout],
      unref: [Function: unref],
      _write: [Function: _write],
      destroy: [Function: destroy],
      write: [Function],
      cork: [Function],
      uncork: [Function],
      setDefaultEncoding: [Function: setDefaultEncoding],
      _writev: null,
      end: [Function],
      writable: [Getter/Setter],
      writableHighWaterMark: [Getter],
      writableObjectMode: [Getter],
      writableBuffer: [Getter],
      writableLength: [Getter],
      writableFinished: [Getter],
      writableCorked: [Getter],
      writableEnded: [Getter],
      writableNeedDrain: [Getter],
      destroyed: [Getter/Setter],
      _undestroy: [Function: undestroy],
      push: [Function],
      unshift: [Function],
      isPaused: [Function],
      setEncoding: [Function],
      read: [Function],
      pipe: [Function],
      unpipe: [Function],
      on: [Function],
      addListener: [Function],
      removeListener: [Function],
      off: [Function],
      removeAllListeners: [Function],
      resume: [Function],
      pause: [Function],
      wrap: [Function],
      iterator: [Function],
      readable: [Getter/Setter],
      readableDidRead: [Getter],
      readableAborted: [Getter],
      readableHighWaterMark: [Getter],
      readableBuffer: [Getter],
      readableFlowing: [Getter/Setter],
      readableLength: [Getter],
      readableObjectMode: [Getter],
      readableEncoding: [Getter],
      errored: [Getter],
      closed: [Getter],
      readableEnded: [Getter],
      drop: [Function],
      filter: [Function],
      flatMap: [Function],
      map: [Function],
      take: [Function],
      compose: [Function],
      every: [Function],
      forEach: [Function],
      reduce: [Function],
      toArray: [Function],
      some: [Function],
      find: [Function],
      [Symbol(nodejs.rejection)]: [Function],
      [Symbol(Symbol.asyncDispose)]: [Function],
      [Symbol(Symbol.asyncIterator)]: [Function],
      eventNames: [Function: eventNames],
    },
    res: IncomingMessage {
      [Symbol(aborted)]: false,
      [Symbol(eofInProgress)]: true,
      _consuming: true,
      _dumped: false,
      complete: true,
      _closed: false,
      [Symbol(noBody)]: false,
      _events: [Object ...],
      _readableState: [Object ...],
      _maxListeners: undefined,
      [Symbol(kCapture)]: false,
      _eventsCount: NaN,
      [Symbol(FetchAPI)]: Response (0 KB) {
        ok: false,
        url: "https://open.feishu.cn/open-apis/cardkit/v1/cards/7575031704667475124",
        status: 400,
        statusText: "Bad Request",
        headers: Headers [Object ...],
        redirected: false,
        bodyUsed: true
      },
      [Symbol(type)]: 1,
      [Symbol(bodyStream)]: undefined,
      [Symbol(statusMessage)]: "Bad Request",
      [Symbol(statusCode)]: 400,
      url: "/open-apis/cardkit/v1/cards/7575031704667475124",
      headers: [Object ...],
      rawHeaders: [
        "content-type", "application/json; charset=utf-8", "content-length", "373", "connection",
        "keep-alive", "date", "Fri, 21 Nov 2025 04:32:08 GMT", "server-timing", "inner; dur=28, cdn-cache;desc=MISS,edge;dur=0,origin;dur=55",
        "via", "vcache4.cn1402[55,0]", "timing-allow-origin", "*", "Server", "Tengine", "X-Tt-Logid",
        "20251121123208C6E69B35C6B4404DF635", "X-Lgw-Dst-Svc", "d-U0Nbd-G7pDq7tkexfZiQWGHuOmreWjJD7KoRU2yyliXI4RlewoMcBkztQEw5IuyklaUwETeBt23q20UuR-Ly_hA7bFMfV0v0CBeYm6EHquOONZhYtGd7YqBKCf_lU_9nK_2pESLWjRApzeA7QK6ExjDR6Z5YBKdTxwLKgHoWqBtVu8sZE-bV5ALrioD2_zcZp5Slato9WSW08s_Yfo4GRTCEcWd-4DDXHaFdC53-Xc-fVpRg==",
        "Tt_stable", "1", "X-Request-Id", "910401d7-bff3-4573-a03b-3160e8b2c732", "Request-Id",
        "910401d7-bff3-4573-a03b-3160e8b2c732", "x-tt-trace-host", "01f5563db8f7e8f46fe210cc28722285d5582c029b4c038f600c442fcb8bb73a8004c6bbc0c48aa2ec33c1c4abbb2bd3d2f22dae40b0190abfefff5cd08fb72e6620c8f645d2ba2eb8b4284381081b36045d28a354f551f25b44b20287b89b832d",
        "x-tt-trace-tag", "id=03;cdn-cache=miss;type=dyn", "x-tt-trace-id", "00-251121123208C6E69B35C6B4404DF635-2B960B0F1A1EC6BB-00",
        "X-Timestamp", "1763699528.099", "x-alicdn-da-ups-status", "endOs,0,400", "EagleId",
        "65597d2f17636995280571342e"
      ],
      [Symbol(fakeSocket)]: [Object ...],
      req: [Circular],
      setTimeout: [Function],
      responseUrl: "https://open.feishu.cn/open-apis/cardkit/v1/cards/7575031704667475124",
      redirects: [],
      [Symbol(kAutoDestroyed)]: true,
      httpVersion: "1.1",
      _construct: [Function: _construct],
      _dump: [Function: _dump],
      _read: [Function: _read],
      _finish: [Function: _finish],
      _destroy: [Function: IncomingMessage_destroy],
      aborted: [Getter/Setter],
      connection: [Getter],
      statusCode: [Getter/Setter],
      statusMessage: [Getter/Setter],
      httpVersionMajor: [Getter/Setter],
      httpVersionMinor: [Getter/Setter],
      rawTrailers: [Getter/Setter],
      trailers: [Getter/Setter],
      socket: [Getter/Setter],
      destroy: [Function: destroy],
      _undestroy: [Function: undestroy],
      push: [Function],
      unshift: [Function],
      isPaused: [Function],
      setEncoding: [Function],
      read: [Function],
      pipe: [Function],
      unpipe: [Function],
      on: [Function],
      addListener: [Function],
      removeListener: [Function],
      off: [Function],
      removeAllListeners: [Function],
      resume: [Function],
      pause: [Function],
      wrap: [Function],
      iterator: [Function],
      readable: [Getter/Setter],
      readableDidRead: [Getter],
      readableAborted: [Getter],
      readableHighWaterMark: [Getter],
      readableBuffer: [Getter],
      readableFlowing: [Getter/Setter],
      readableLength: [Getter],
      readableObjectMode: [Getter],
      readableEncoding: [Getter],
      errored: [Getter],
      closed: [Getter],
      destroyed: [Getter/Setter],
      readableEnded: [Getter],
      drop: [Function],
      filter: [Function],
      flatMap: [Function],
      map: [Function],
      take: [Function],
      compose: [Function],
      every: [Function],
      forEach: [Function],
      reduce: [Function],
      toArray: [Function],
      some: [Function],
      find: [Function],
      [Symbol(nodejs.rejection)]: [Function],
      [Symbol(Symbol.asyncDispose)]: [Function],
      [Symbol(Symbol.asyncIterator)]: [Function],
      eventNames: [Function: eventNames],
      setMaxListeners: [Function: setMaxListeners],
      getMaxListeners: [Function: getMaxListeners],
      emit: [Function: emit],
      prependListener: [Function: prependListener],
      once: [Function: once],
      prependOnceListener: [Function: prependOnceListener],
      listeners: [Function: listeners],
      rawListeners: [Function: rawListeners],
      listenerCount: [Function: listenerCount],
    },
    _closed: true,
    complete: true,
    setTimeout: [Function: setTimeout],
    clearTimeout: [Function: clearTimeout],
    path: [Getter],
    port: [Getter],
    method: [Getter],
    host: [Getter],
    protocol: [Getter],
    agent: [Getter/Setter],
    aborted: [Getter/Setter],
    writable: [Getter],
    _keepAliveTimeout: 0,
    _defaultKeepAlive: true,
    shouldKeepAlive: true,
    _onPendingData: [Function: nop2],
    outputSize: 0,
    outputData: [],
    strictContentLength: false,
    _removedTE: false,
    _removedContLen: false,
    _removedConnection: false,
    usesChunkedEncodingByDefault: true,
    _headerNames: [Getter/Setter],
    appendHeader: [Function: appendHeader],
    _implicitHeader: [Function: _implicitHeader],
    getHeader: [Function: getHeader],
    pipe: [Function: pipe],
    getHeaderNames: [Function: getHeaderNames],
    getRawHeaderNames: [Function: getRawHeaderNames],
    getHeaders: [Function: getHeaders],
    removeHeader: [Function: removeHeader],
    setHeader: [Function: setHeader],
    setHeaders: [Function: setHeaders],
    hasHeader: [Function: hasHeader],
    headers: [Getter/Setter],
    addTrailers: [Function: addTrailers],
    connection: [Getter/Setter],
    socket: [Getter/Setter],
    chunkedEncoding: [Getter/Setter],
    writableObjectMode: [Getter],
    writableLength: [Getter],
    writableHighWaterMark: [Getter],
    writableNeedDrain: [Getter],
    writableEnded: [Getter],
    writableFinished: [Getter],
    _send: [Function: _send],
    _writeRaw: [Function: _writeRaw],
    writableCorked: [Getter/Setter],
    cork: [Function: cork],
    uncork: [Function: uncork],
    _headers: [Getter/Setter],
    eventNames: [Function: eventNames],
    setMaxListeners: [Function: setMaxListeners],
    getMaxListeners: [Function: getMaxListeners],
    emit: [Function: emit],
    addListener: [Function: addListener],
    on: [Function: addListener],
    prependListener: [Function: prependListener],
    once: [Function: once],
    prependOnceListener: [Function: prependOnceListener],
    removeListener: [Function: removeListener],
    off: [Function: removeListener],
    removeAllListeners: [Function: removeAllListeners],
    listeners: [Function: listeners],
    rawListeners: [Function: rawListeners],
    listenerCount: [Function: listenerCount],
    [Symbol(kCapture)]: false,
  },
  response: {
    status: 400,
    statusText: "Bad Request",
    headers: {
      "content-type": "application/json; charset=utf-8",
      "content-length": "373",
      connection: "keep-alive",
      date: "Fri, 21 Nov 2025 04:32:08 GMT",
      "server-timing": "inner; dur=28, cdn-cache;desc=MISS,edge;dur=0,origin;dur=55",
      via: "vcache4.cn1402[55,0]",
      "timing-allow-origin": "*",
      server: "Tengine",
      "x-tt-logid": "20251121123208C6E69B35C6B4404DF635",
      "x-lgw-dst-svc": "d-U0Nbd-G7pDq7tkexfZiQWGHuOmreWjJD7KoRU2yyliXI4RlewoMcBkztQEw5IuyklaUwETeBt23q20UuR-Ly_hA7bFMfV0v0CBeYm6EHquOONZhYtGd7YqBKCf_lU_9nK_2pESLWjRApzeA7QK6ExjDR6Z5YBKdTxwLKgHoWqBtVu8sZE-bV5ALrioD2_zcZp5Slato9WSW08s_Yfo4GRTCEcWd-4DDXHaFdC53-Xc-fVpRg==",
      tt_stable: "1",
      "x-request-id": "910401d7-bff3-4573-a03b-3160e8b2c732",
      "request-id": "910401d7-bff3-4573-a03b-3160e8b2c732",
      "x-tt-trace-host": "01f5563db8f7e8f46fe210cc28722285d5582c029b4c038f600c442fcb8bb73a8004c6bbc0c48aa2ec33c1c4abbb2bd3d2f22dae40b0190abfefff5cd08fb72e6620c8f645d2ba2eb8b4284381081b36045d28a354f551f25b44b20287b89b832d",
      "x-tt-trace-tag": "id=03;cdn-cache=miss;type=dyn",
      "x-tt-trace-id": "00-251121123208C6E69B35C6B4404DF635-2B960B0F1A1EC6BB-00",
      "x-timestamp": "1763699528.099",
      "x-alicdn-da-ups-status": "endOs,0,400",
      eagleid: "65597d2f17636995280571342e",
    },
    config: {
      transitional: [Object ...],
      adapter: [Function: httpAdapter],
      transformRequest: [
        [Function: transformRequest]
      ],
      transformResponse: [
        [Function: transformResponse]
      ],
      timeout: 0,
      xsrfCookieName: "XSRF-TOKEN",
      xsrfHeaderName: "X-XSRF-TOKEN",
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object ...],
      validateStatus: [Function: validateStatus],
      headers: [Object ...],
      url: "https://open.feishu.cn/open-apis/cardkit/v1/cards/7575031704667475124",
      method: "put",
      data: "{\"patches\":[{\"op\":\"add\",\"path\":\"/body/elements/-\",\"value\":{\"tag\":\"div\",\"fields\":[{\"tag\":\"action\",\"actions\":[{\"tag\":\"button\",\"text\":{\"content\":\"Tell me more\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"Tell me more\"},{\"tag\":\"button\",\"text\":{\"content\":\"How do I apply this?\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"How do I apply this?\"},{\"tag\":\"button\",\"text\":{\"content\":\"What's next?\",\"tag\":\"plain_text\"},\"type\":\"default\",\"size\":\"medium\",\"value\":\"What's next?\"}]}]}}],\"sequence\":23}",
      params: [Object ...],
      paramsSerializer: [Function: paramsSerializer],
    },
    request: ClientRequest {
      write: [Function],
      end: [Function],
      flushHeaders: [Function],
      destroy: [Function],
      _ensureTls: [Function],
      abort: [Function],
      [Symbol(tls)]: null,
      [Symbol(kAbortController)]: [AbortController ...],
      [Symbol(agent)]: [Object ...],
      destroyed: false,
      [Symbol(protocol)]: "https:",
      [Symbol(port)]: 443,
      [Symbol(useDefaultPort)]: true,
      [Symbol(host)]: "open.feishu.cn",
      [Symbol(socketPath)]: undefined,
      [Symbol(method)]: "PUT",
      maxHeaderSize: undefined,
      [Symbol(maxHeaderSize)]: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      [Symbol(path)]: "/open-apis/cardkit/v1/cards/7575031704667475124",
      _events: [Object ...],
      _eventsCount: 6,
      finished: true,
      [Symbol(res)]: null,
      [Symbol(upgradeOrConnect)]: false,
      [Symbol(parser)]: null,
      [Symbol(maxHeadersCount)]: null,
      [Symbol(reusedSocket)]: false,
      [Symbol(headers)]: Headers [Object ...],
      [Symbol(options)]: [Object ...],
      _httpMessage: [Circular],
      [Symbol(emitState)]: 14,
      setSocketKeepAlive: [Function],
      setNoDelay: [Function],
      [Symbol(kClearTimeout)]: [Function],
      _redirectable: [Object ...],
      [Symbol(bodyChunks)]: [
        <Buffer 7b 22 70 61 74 63 68 65 73 22 3a 5b 7b 22 6f 70 22 3a 22 61 64 64 22 2c 22 70 61 74 68 22 3a 22 2f 62 6f 64 79 2f 65 6c 65 6d 65 6e 74 73 2f 2d 22 2c ... 472 more bytes>
      ],
      [Symbol(fetchRequest)]: null,
      [Symbol(fakeSocket)]: [Object ...],
      res: [Object ...],
      _closed: true,
      complete: true,
      setTimeout: [Function: setTimeout],
      clearTimeout: [Function: clearTimeout],
      path: [Getter],
      port: [Getter],
      method: [Getter],
      host: [Getter],
      protocol: [Getter],
      agent: [Getter/Setter],
      aborted: [Getter/Setter],
      writable: [Getter],
      _keepAliveTimeout: 0,
      _defaultKeepAlive: true,
      shouldKeepAlive: true,
      _onPendingData: [Function: nop2],
      outputSize: 0,
      outputData: [],
      strictContentLength: false,
      _removedTE: false,
      _removedContLen: false,
      _removedConnection: false,
      usesChunkedEncodingByDefault: true,
      _headerNames: [Getter/Setter],
      appendHeader: [Function: appendHeader],
      _implicitHeader: [Function: _implicitHeader],
      getHeader: [Function: getHeader],
      pipe: [Function: pipe],
      getHeaderNames: [Function: getHeaderNames],
      getRawHeaderNames: [Function: getRawHeaderNames],
      getHeaders: [Function: getHeaders],
      removeHeader: [Function: removeHeader],
      setHeader: [Function: setHeader],
      setHeaders: [Function: setHeaders],
      hasHeader: [Function: hasHeader],
      headers: [Getter/Setter],
      addTrailers: [Function: addTrailers],
      connection: [Getter/Setter],
      socket: [Getter/Setter],
      chunkedEncoding: [Getter/Setter],
      writableObjectMode: [Getter],
      writableLength: [Getter],
      writableHighWaterMark: [Getter],
      writableNeedDrain: [Getter],
      writableEnded: [Getter],
      writableFinished: [Getter],
      _send: [Function: _send],
      _writeRaw: [Function: _writeRaw],
      writableCorked: [Getter/Setter],
      cork: [Function: cork],
      uncork: [Function: uncork],
      _headers: [Getter/Setter],
      eventNames: [Function: eventNames],
      setMaxListeners: [Function: setMaxListeners],
      getMaxListeners: [Function: getMaxListeners],
      emit: [Function: emit],
      addListener: [Function: addListener],
      on: [Function: addListener],
      prependListener: [Function: prependListener],
      once: [Function: once],
      prependOnceListener: [Function: prependOnceListener],
      removeListener: [Function: removeListener],
      off: [Function: removeListener],
      removeAllListeners: [Function: removeAllListeners],
      listeners: [Function: listeners],
      rawListeners: [Function: rawListeners],
      listenerCount: [Function: listenerCount],
      [Symbol(kCapture)]: false,
    },
    data: {
      code: 99992402,
      msg: "field validation failed",
      error: [Object ...],
    },
  },
  toJSON: [Function: toJSON],
  isAxiosError: true,
  toString: [Function: toString],
}
ğŸ¯ [CardButtons] addFollowupButtons completed
âœ… [CardButtons] Card finalized with 3 follow-up buttons
[FeishuMention] Finalization result: {
  followups: [
    {
      text: "Tell me more",
      type: "question",
    }, {
      text: "How do I apply this?",
      type: "question",
    }, {
      text: "What's next?",
      type: "action",
    }
  ],
}
[error]: [
  [
    {
      message: "The socket connection was closed unexpectedly. For more information, pass `verbose: true` in the second argument to fetch()",
      config: [Object ...],
      request: [Object ...],
      response: [Object ...],
    }
  ]
]
error: script "dev" was terminated by signal SIGTERM (Polite quit request)
