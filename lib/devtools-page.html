<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI SDK Devtools - Feishu Assistant</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
        sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: #0a0a0a;
      color: #fff;
      height: 100vh;
      overflow: hidden;
    }
    #root {
      width: 100%;
      height: 100%;
    }
    .header {
      padding: 1rem;
      background: #1a1a1a;
      border-bottom: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header h1 {
      font-size: 1.25rem;
      font-weight: 600;
    }
    .status {
      padding: 0.5rem 1rem;
      background: #0a5;
      border-radius: 4px;
      font-size: 0.875rem;
    }
    .info {
      padding: 1rem;
      background: #1a1a1a;
      border-bottom: 1px solid #333;
      font-size: 0.875rem;
      color: #aaa;
    }
    .info code {
      background: #2a2a2a;
      padding: 0.25rem 0.5rem;
      border-radius: 3px;
      font-family: 'Monaco', 'Courier New', monospace;
    }
  </style>
</head>
<body>
  <div id="root">
    <div class="header">
      <h1>ðŸ”§ AI SDK Devtools</h1>
      <div class="status">Connected</div>
    </div>
    <div class="info">
      Monitoring AI tool calls, agent handoffs, and performance metrics.
      <br>
      Server: <code id="server-url"></code>
    </div>
    <div id="devtools-container" style="display: flex; gap: 1rem; padding: 1rem; height: calc(100vh - 120px); overflow: hidden;">
      <div id="events-list" style="flex: 1; overflow-y: auto; border-right: 1px solid #333;"></div>
      <div id="event-detail" style="flex: 1; overflow-y: auto; padding: 1rem;"></div>
    </div>
  </div>

  <script>
    const serverUrl = window.location.origin;
    document.getElementById('server-url').textContent = serverUrl;

    const eventsList = document.getElementById('events-list');
    const eventDetail = document.getElementById('event-detail');
    let allEvents = [];
    let selectedEventId = null;

    // Fetch events from the API
    async function fetchEvents() {
      try {
        const response = await fetch(`${serverUrl}/devtools/api/events`);
        const data = await response.json();
        allEvents = data.events || [];
        renderEventsList();
      } catch (error) {
        console.error('Failed to fetch events:', error);
        eventsList.innerHTML = `<div style="padding: 1rem; color: #f00;">Error loading events</div>`;
      }
    }

    function renderEventsList() {
      if (allEvents.length === 0) {
        eventsList.innerHTML = `<div style="padding: 1rem; color: #666;">Waiting for events...</div>`;
        return;
      }

      eventsList.innerHTML = allEvents.map(event => `
        <div 
          data-event-id="${event.id}"
          style="
            padding: 0.75rem;
            border-bottom: 1px solid #333;
            cursor: pointer;
            background: ${selectedEventId === event.id ? '#333' : 'transparent'};
            transition: background 0.2s;
          "
          onclick="selectEvent('${event.id}')"
        >
          <div style="font-size: 0.875rem; color: #0a5; margin-bottom: 0.25rem;">
            ${event.type} - ${event.agent}
          </div>
          <div style="font-size: 0.75rem; color: #666;">
            ${new Date(event.timestamp).toLocaleTimeString()}
          </div>
          ${event.data?.query ? `<div style="font-size: 0.75rem; color: #aaa; margin-top: 0.25rem;">${event.data.query.substring(0, 50)}</div>` : ''}
        </div>
      `).join('');
    }

    function selectEvent(eventId) {
      selectedEventId = eventId;
      const event = allEvents.find(e => e.id === eventId);
      
      if (event) {
        eventDetail.innerHTML = `
          <div>
            <h3 style="margin-bottom: 1rem; color: #0a5;">${event.type}</h3>
            <div style="background: #1a1a1a; padding: 1rem; border-radius: 4px;">
              <div style="margin-bottom: 0.75rem;">
                <span style="color: #666;">Agent:</span> ${event.agent}
              </div>
              <div style="margin-bottom: 0.75rem;">
                <span style="color: #666;">Type:</span> ${event.type}
              </div>
              <div style="margin-bottom: 0.75rem;">
                <span style="color: #666;">Duration:</span> ${event.duration}ms
              </div>
              <div style="margin-bottom: 0.75rem;">
                <span style="color: #666;">Time:</span> ${new Date(event.timestamp).toLocaleString()}
              </div>
              <div style="margin-top: 1.5rem;">
                <span style="color: #666;">Data:</span>
                <pre style="background: #0a0a0a; padding: 0.75rem; border-radius: 4px; margin-top: 0.5rem; font-size: 0.75rem; overflow-x: auto;">
${JSON.stringify(event.data, null, 2)}
                </pre>
              </div>
            </div>
          </div>
        `;
      }
      renderEventsList();
    }

    // Fetch events every 1 second
    fetchEvents();
    setInterval(fetchEvents, 1000);
  </script>
</body>
</html>

