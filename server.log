$ bun server.ts
[info]: [ "client ready" ]
âœ… [Memory] Connected to Supabase database
[info]: [ "event-dispatch is ready" ]
ğŸ“‹ [Startup] Starting server initialization...
ğŸ“‹ [Startup] Step 0: Initializing Mastra Memory (3-layer architecture)...
âœ… [Memory] Connected to PostgreSQL storage (Mastra)
âœ… [Memory] Mastra memory system initialized
âœ… [Startup] Step 0: Mastra Memory initialized
ğŸ“‹ [Startup] Mode: Subscription (WebSocket)
ğŸ“‹ [Startup] Step 1: Initializing WebSocket connection...
[info]: [ "[ws]", "receive events or callbacks through persistent connection only available in self-build & Feishu app, Configured in:\n        Developer Console(å¼€å‘è€…åå°) \n          ->\n        Events and Callbacks(äº‹ä»¶ä¸å›è°ƒ)\n          -> \n        Mode of event/callback subscription(è®¢é˜…æ–¹å¼)\n          -> \n        Receive events/callbacks through persistent connection(ä½¿ç”¨ é•¿è¿æ¥ æ¥æ”¶äº‹ä»¶/å›è°ƒ)" ]
âœ… [Startup] Step 1: WebSocket connection established
ğŸ“‹ [Startup] Ready to receive Feishu events
ğŸ“‹ [Startup] Step 2: Starting HTTP server...
âœ… [Startup] Step 2: HTTP server started on port 3000
âœ¨ [Startup] Server is ready to accept requests
ğŸ“Š [Startup] Health check: curl http://localhost:3000/health
[info]: [ "[ws]", "ws client ready" ]
ğŸ“¨ [WebSocket] Event received: im.message.receive_v1
ğŸ“¨ [WebSocket] Event data: {
  "schema": "2.0",
  "event_id": "55cca4353257db8485dc53bc43333819",
  "token": "",
  "create_time": "1764312231267",
  "event_type": "im.message.receive_v1",
  "tenant_key": "2de1f662118f575d",
  "app_id": "cli_a6af6b76c6f0d013",
  "message": {
    "chat_id": "oc_cd4b98905e12ec0cb68adc529440e623",
    "chat_type": "group",
    "content": "{\"text\":\"@_user_1 @_user_2 æ˜¯DPA team çš„ä¸€æšanalytics engineerï¼š è´Ÿè´£æ•´ä¸ªdata stack(i.e. dbt â”dagster â” bi dashboard etc.)\\nä½ æœ‰ä»–çš„OKRå—\"}",
    "create_time": "1764312230929",
    "mentions": [
      {
        "id": {
          "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
          "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
          "user_id": ""
        },
        "key": "@_user_1",
        "name": "Evi",
        "tenant_key": "2de1f662118f575d"
      },
      {
        "id": {
          "open_id": "ou_a6f7929ae2b9aa185c375b14d19b4a22",
          "union_id": "on_fa474c31e356ff2b1b8d76c2b453f886",
          "user_id": "angus.zhan"
        },
        "key": "@_user_2",
        "name": "Angus ZHAN è©¹ä¼Ÿç¿€",
        "tenant_key": "2de1f662118f575d"
      }
    ],
    "message_id": "om_x100b5da004a104b8c38cf30589d78a1",
    "message_type": "text",
    "parent_id": "om_x100b5db4fd4a6c80c4427c8274336f7",
    "root_id": "om_x100b5db4fd4a6c80c4427c8274336f7",
    "thread_id": "omt_1a4d83f1580d1be8",
    "update_time": "1764312231022",
    "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 15_3_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.6778.268 Safari/537.36 Lark/7.56.5 LarkLocale/zh_CN ttnet SDK-Version/7.56.19"
  },
  "sender": {
    "sender_id": {
      "open_id": "ou_db4d1d08c4fcd3f1f4c253eab32ff580",
      "union_id": "on_80d62273b85f0904e27382a59cc1f730",
      "user_id": "xiaofei.yin"
    },
    "sender_type": "user",
    "tenant_key": "2de1f662118f575d"
  }
}
ğŸ¤– [WebSocket] Bot User ID: cli_a6af6b76c6f0d013
ğŸ‘¤ [Auth] Extracted user ID: ou_db4d1d08c4fcd3f1f4c253eab32ff580
ğŸ“© [WebSocket] Message details: chatId=oc_cd4b98905e12ec0cb68adc529440e623, messageId=om_x100b5da004a104b8c38cf30589d78a1, chatType=group
ğŸ” [WebSocket] Mentions array: [
  {
    "id": {
      "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
      "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
      "user_id": ""
    },
    "key": "@_user_1",
    "name": "Evi",
    "tenant_key": "2de1f662118f575d"
  },
  {
    "id": {
      "open_id": "ou_a6f7929ae2b9aa185c375b14d19b4a22",
      "union_id": "on_fa474c31e356ff2b1b8d76c2b453f886",
      "user_id": "angus.zhan"
    },
    "key": "@_user_2",
    "name": "Angus ZHAN è©¹ä¼Ÿç¿€",
    "tenant_key": "2de1f662118f575d"
  }
]
ğŸ“Œ [WebSocket] Extracted mentioned user ID: ou_b996baaafd4fd8f41d219ec7ad2af324 (Evi)
ğŸ” [WebSocket] Found 2 mention(s) in group message
âœ… [WebSocket] Bot mention detected via mentions array
ğŸ‘¥ [WebSocket] Processing group mention: "@_user_1 @_user_2 æ˜¯DPA team çš„ä¸€æšanalytics engineerï¼š..."
ğŸ’¾ [WebSocket] Using user ID for memory context: ou_b996baaafd4fd8f41d219ec7ad2af324 (from mention)
Handling app mention
ğŸ“¤ [Card] Creating and sending streaming card to chat_id:oc_cd4b98905e12ec0cb68adc529440e623
âœ… [Card] Created streaming card: cardId=7577663417655971021, elementId=md_12250750
ğŸ“¨ [Card] Sending card message with cardId: 7577663417655971021
ğŸ“¨ [Card] Sending as thread reply to message: om_x100b5da004a104b8c38cf30589d78a1
âœ… [Card] Card sent successfully: messageId=om_x100b5da0057a48a8c3dd5df9944ee52, cardId=7577663417655971021
[Thread] Fetching thread history: rootId=om_x100b5db4fd4a6c80c4427c8274336f7, messageId=om_x100b5da004a104b8c38cf30589d78a1
âŒ Failed to fetch thread after 1 attempt: Thread fetch timeout after 5000ms
âš ï¸ Proceeding with empty thread context (falling back to current message only)
âš ï¸ [Thread] Thread history empty or fetch failed, using current message only
[Thread] Fallback: Starting fresh with current message only
[Thread] Processing with 1 message(s)
[FeishuMention] Generating response...
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using fallback model: Google Gemini 2.5 Flash (Paid (reliable, no rate limits))
[Manager] Received query: "@_user_2 æ˜¯DPA team çš„ä¸€æšanalytics engineerï¼š è´Ÿè´£æ•´ä¸ªdata stack(i.e. dbt â”dagster â” bi dashboard etc.)
ä½ æœ‰ä»–çš„OKRå—"
[Manager] Manual routing detected: OKR Reviewer matches query
[OKR] Memory context: conversationId=feishu:oc_cd4b98905e12ec0cb68adc529440e623:om_x100b5db4fd4a6c80c4427c8274336f7, userId=user:ou_b996baaafd4fd8f41d219ec7ad2af324
[Cache] MISS
[OKR] Looking for latest table matching 'okr_metrics_%' in schema 'onvo_dpa_data'
[OKR] Found latest StarRocks table: onvo_dpa_data.okr_metrics_20251126_151307
[OKR] Querying StarRocks for period: "undefined" using table: onvo_dpa_data.okr_metrics_20251126_151307
âŒ [OKR] StarRocks query error for period "undefined": 31 |     if (connection instanceof PromisePoolConnection) connection.release();
32 |   }
33 | 
34 |   query(sql, args) {
35 |     const corePool = this.pool;
36 |     const localErr = new Error();
                          ^
error: Unknown table 'onvo_dpa_data.employee_fellow'
      errno: 1064,
        sql: "\n      WITH base AS (\n        SELECT COALESCE(e.fellow_city_company_name, 'Unknown') AS company_name,\n               m.metric_type,\n               m.value\n        FROM onvo_dpa_data.okr_metrics_20251126_151307 m\n        LEFT JOIN onvo_dpa_data.employee_fellow e\n          ON m.owner = e.fellow_ad_account\n        WHERE m.period = NULL\n          AND e.fellow_workday_cn_title IN ('ä¹é“ä»£ç†æˆ˜é˜Ÿé•¿', 'ä¹é“åŒºåŸŸå‰¯æ€»ç»ç†', 'ä¹é“åŒºåŸŸæ€»ç»ç†', 'ä¹é“åŒºåŸŸè¡Œé”€è´Ÿè´£äºº', 'ä¹é“æˆ˜é˜Ÿé•¿', 'ä¹é“æˆ˜é˜Ÿé•¿ï¼ˆå…¼ä¸ªäººé”€å”®ï¼‰', 'ä¹é“ç‰‡åŒºæ€»', 'ä¹é“è¡Œé”€å¤§åŒºè´Ÿè´£äºº', 'ä¹é“é”€å”®éƒ¨è´Ÿè´£äºº')\n          \n      )\n      SELECT company_name, metric_type,\n             COUNT(*) AS total,\n             SUM(CASE WHEN value IS NULL THEN 1 ELSE 0 END) AS nulls,\n             100.0 * SUM(CASE WHEN value IS NULL THEN 1 ELSE 0 END) / NULLIF(COUNT(*),0) AS null_pct\n      FROM base\n      WHERE company_name != 'Unknown'\n      GROUP BY company_name, metric_type\n    ",
   sqlState: "HY000",
 sqlMessage: "Unknown table 'onvo_dpa_data.employee_fellow'",
       code: "ER_PARSE_ERROR"

      at query (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/mysql2/lib/promise/pool.js:36:22)
      at queryStarrocks (/Users/xiaofei.yin/work_repo/feishu_assistant/lib/starrocks/client.ts:40:29)
      at queryStarrocks (/Users/xiaofei.yin/work_repo/feishu_assistant/lib/starrocks/client.ts:38:47)
      at analyzeHasMetricPercentageStarrocks (/Users/xiaofei.yin/work_repo/feishu_assistant/lib/agents/okr-reviewer-agent.ts:170:24)

âš ï¸ [OKR] StarRocks query failed, falling back to DuckDB: Unknown table 'onvo_dpa_data.employee_fellow'
[OKR] Analyzing period: "undefined" from table: okr_metrics_20251126_151307
[OKR] Query returned 0 rows for period "undefined"
[Cache] STORED result
ğŸ”„ [Card] Updating card element: cardId=7577663417655971021, elementId=md_12250750, sequence=1, contentLength=50
ğŸ”„ [Card] Updating card element: cardId=7577663417655971021, elementId=md_12250750, sequence=2, contentLength=150
ğŸ”„ [Card] Updating card element: cardId=7577663417655971021, elementId=md_12250750, sequence=3, contentLength=300
ğŸ”„ [Card] Updating card element: cardId=7577663417655971021, elementId=md_12250750, sequence=4, contentLength=350
ğŸ”„ [Card] Updating card element: cardId=7577663417655971021, elementId=md_12250750, sequence=5, contentLength=400
ğŸ”„ [Card] Updating card element: cardId=7577663417655971021, elementId=md_12250750, sequence=6, contentLength=450
ğŸ”„ [Card] Updating card element: cardId=7577663417655971021, elementId=md_12250750, sequence=7, contentLength=550
ğŸ”„ [Card] Updating card element: cardId=7577663417655971021, elementId=md_12250750, sequence=8, contentLength=600
ğŸ”„ [Card] Updating card element: cardId=7577663417655971021, elementId=md_12250750, sequence=9, contentLength=800
ğŸ”„ [Card] Updating card element: cardId=7577663417655971021, elementId=md_12250750, sequence=10, contentLength=801
[OKR] Response complete (length=801)
[FeishuMention] Response generated (length=801): "è®©æˆ‘ä¸ºæ‚¨æŸ¥è¯¢ @_user_2 çš„OKRä¿¡æ¯ã€‚

æˆ‘æ³¨æ„åˆ°å½“å‰æŸ¥è¯¢æ²¡æœ‰è¿”å› @_user_2 çš„OK..."
[FeishuMention] Finalizing card with suggestions. cardId=7577663417655971021, result length=801
ğŸ¯ [CardSuggestions] Finalizing card with follow-ups: cardId=7577663417655971021, contentLength=801
ğŸ¯ [CardSuggestions] Generating follow-up suggestions...
ğŸ”„ [Followups] Generating 3 follow-up questions for response: "è®©æˆ‘ä¸ºæ‚¨æŸ¥è¯¢ @_user_2 çš„OKRä¿¡æ¯ã€‚

æˆ‘æ³¨æ„åˆ°å½“å‰æŸ¥è¯¢æ²¡æœ‰è¿”å› @_user_2 çš„OK..."
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ”„ [Followups] LLM raw response (first 300 chars): "[
  {"text": "å¦‚ä½•è·å– @_user_2 çš„å®é™…OKRæ•°æ®è®°å½•ï¼Ÿ", "type": "question"},
  {"text": "å»ºè®®è®¾ç½®å®šæœŸOKRè¿›åº¦å¤ç›˜ä¼šè®®", "type": "recommendation"},
  {"text": "è”ç³»HRæˆ–ä¸Šçº§è·å–OKRç³»ç»Ÿè®¿é—®æƒé™", "type": "action"}
]..."
ğŸ”„ [Followups] Extracted JSON (first 200 chars): "[
  {"text": "å¦‚ä½•è·å– @_user_2 çš„å®é™…OKRæ•°æ®è®°å½•ï¼Ÿ", "type": "question"},
  {"text": "å»ºè®®è®¾ç½®å®šæœŸOKRè¿›åº¦å¤ç›˜ä¼šè®®", "type": "recommendation"},
  {"text": "è”ç³»HRæˆ–ä¸Šçº§è·å–OKRç³»ç»Ÿè®¿é—®æƒé™", "type": "action"}
]..."
âœ… [Followups] Generated 3 follow-up options with metadata
ğŸ¯ [CardSuggestions] generateFollowupQuestions returned 3 followups
ğŸ¯ [CardSuggestions] Generated 3 follow-up suggestions (will show as buttons)
ğŸ¯ [CardSuggestions] Disabling streaming mode...
âœ… [CardSuggestions] Streaming mode disabled (card content: response only, no duplicate suggestions)
ğŸ”˜ [CardSuggestions] Sending buttons in separate message (Hypothesis 1)...
ğŸ”˜ [FollowupButtons] Sending 3 buttons in separate message...
ğŸ”˜ [FollowupButtons] Creating card via CardKit...
ğŸ”˜ [FollowupButtons] Card created: 7577663639958129888
ğŸ”˜ [FollowupButtons] Sending as thread reply to rootId=om_x100b5da004a104b8c38cf30589d78a1...
ğŸ”˜ [FollowupButtons] API response: {
  "code": 0,
  "data": {
    "body": {
      "content": "{\"title\":\"Suggestions\",\"elements\":[[{\"tag\":\"img\",\"image_key\":\"img_v3_02ad_e19fca1f-912a-450e-95de-3c229091b53g\"},{\"tag\":\"text\",\"text\":\"è¯·å‡çº§è‡³æœ€æ–°ç‰ˆæœ¬å®¢æˆ·ç«¯ï¼Œä»¥æŸ¥çœ‹å†…å®¹\"},{\"tag\":\"text\",\"text\":\"\"}]]}"
    },
    "chat_id": "oc_cd4b98905e12ec0cb68adc529440e623",
    "create_time": "1764312303833",
    "deleted": false,
    "message_id": "om_x100b5da00034f48cc29866791d11ebb",
    "msg_type": "interactive",
    "parent_id": "om...
ğŸ”˜ [FollowupButtons] isSuccess=true, code=0, has message_id=true
âœ… [FollowupButtons] Successfully sent buttons message: om_x100b5da00034f48cc29866791d11ebb
âœ… [CardSuggestions] Buttons sent in separate message: om_x100b5da00034f48cc29866791d11ebb
[FeishuMention] Card finalized with suggestions (buttons: om_x100b5da00034f48cc29866791d11ebb)
[error]: [
  [
    {
      message: "The socket connection was closed unexpectedly. For more information, pass `verbose: true` in the second argument to fetch()",
      config: [Object ...],
      request: [Object ...],
      response: [Object ...],
    }
  ]
]
ğŸ“¨ [WebSocket] Event received: im.message.receive_v1
ğŸ“¨ [WebSocket] Event data: {
  "schema": "2.0",
  "event_id": "3e20e5150ead3762e16caa4ce4600349",
  "token": "",
  "create_time": "1764312195938",
  "event_type": "im.message.receive_v1",
  "tenant_key": "2de1f662118f575d",
  "app_id": "cli_a6af6b76c6f0d013",
  "message": {
    "chat_id": "oc_cd4b98905e12ec0cb68adc529440e623",
    "chat_type": "group",
    "content": "{\"text\":\"@_user_1 æ˜¯DPA team çš„ä¸€æšanalytics engineerï¼š è´Ÿè´£æ•´ä¸ªdata stack(i.e. dbt â”dagster â” bi dashboard etc.)\\nä½ æœ‰ä»–çš„OKRå—\"}",
    "create_time": "1764312195635",
    "mentions": [
      {
        "id": {
          "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
          "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
          "user_id": ""
        },
        "key": "@_user_1",
        "name": "Evi",
        "tenant_key": "2de1f662118f575d"
      }
    ],
    "message_id": "om_x100b5da006fae498c29cc979b52659e",
    "message_type": "text",
    "parent_id": "om_x100b5db4fd4a6c80c4427c8274336f7",
    "root_id": "om_x100b5db4fd4a6c80c4427c8274336f7",
    "thread_id": "omt_1a4d83f1580d1be8",
    "update_time": "1764312195711"
  },
  "sender": {
    "sender_id": {
      "open_id": "ou_db4d1d08c4fcd3f1f4c253eab32ff580",
      "union_id": "on_80d62273b85f0904e27382a59cc1f730",
      "user_id": "xiaofei.yin"
    },
    "sender_type": "user",
    "tenant_key": "2de1f662118f575d"
  }
}
ğŸ¤– [WebSocket] Bot User ID: cli_a6af6b76c6f0d013
ğŸ‘¤ [Auth] Extracted user ID: ou_db4d1d08c4fcd3f1f4c253eab32ff580
ğŸ“© [WebSocket] Message details: chatId=oc_cd4b98905e12ec0cb68adc529440e623, messageId=om_x100b5da006fae498c29cc979b52659e, chatType=group
ğŸ” [WebSocket] Mentions array: [
  {
    "id": {
      "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
      "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
      "user_id": ""
    },
    "key": "@_user_1",
    "name": "Evi",
    "tenant_key": "2de1f662118f575d"
  }
]
ğŸ“Œ [WebSocket] Extracted mentioned user ID: ou_b996baaafd4fd8f41d219ec7ad2af324 (Evi)
ğŸ” [WebSocket] Found 1 mention(s) in group message
âœ… [WebSocket] Bot mention detected via mentions array
ğŸ‘¥ [WebSocket] Processing group mention: "@_user_1 æ˜¯DPA team çš„ä¸€æšanalytics engineerï¼š è´Ÿè´£æ•´ä¸ªdata..."
ğŸ’¾ [WebSocket] Using user ID for memory context: ou_b996baaafd4fd8f41d219ec7ad2af324 (from mention)
Handling app mention
ğŸ“¤ [Card] Creating and sending streaming card to chat_id:oc_cd4b98905e12ec0cb68adc529440e623
âœ… [Card] Created streaming card: cardId=7577664567564831947, elementId=md_12518990
ğŸ“¨ [Card] Sending card message with cardId: 7577664567564831947
ğŸ“¨ [Card] Sending as thread reply to message: om_x100b5da006fae498c29cc979b52659e
âœ… [Card] Card sent successfully: messageId=om_x100b5da012b704acc29772552d85da0, cardId=7577664567564831947
[Thread] Fetching thread history: rootId=om_x100b5db4fd4a6c80c4427c8274336f7, messageId=om_x100b5da006fae498c29cc979b52659e
âŒ Failed to fetch thread after 1 attempt: Thread fetch timeout after 5000ms
âš ï¸ Proceeding with empty thread context (falling back to current message only)
âš ï¸ [Thread] Thread history empty or fetch failed, using current message only
[Thread] Fallback: Starting fresh with current message only
[Thread] Processing with 1 message(s)
[FeishuMention] Generating response...
[Manager] Received query: "æ˜¯DPA team çš„ä¸€æšanalytics engineerï¼š è´Ÿè´£æ•´ä¸ªdata stack(i.e. dbt â”dagster â” bi dashboard etc.)
ä½ æœ‰ä»–çš„OKRå—"
[Manager] Manual routing detected: OKR Reviewer matches query
[OKR] Memory context: conversationId=feishu:oc_cd4b98905e12ec0cb68adc529440e623:om_x100b5db4fd4a6c80c4427c8274336f7, userId=user:ou_b996baaafd4fd8f41d219ec7ad2af324
[Cache] HIT
[Cache] HIT
ğŸ”„ [Card] Updating card element: cardId=7577664567564831947, elementId=md_12518990, sequence=1, contentLength=150
ğŸ”„ [Card] Updating card element: cardId=7577664567564831947, elementId=md_12518990, sequence=2, contentLength=250
ğŸ”„ [Card] Updating card element: cardId=7577664567564831947, elementId=md_12518990, sequence=3, contentLength=350
ğŸ”„ [Card] Updating card element: cardId=7577664567564831947, elementId=md_12518990, sequence=4, contentLength=400
ğŸ”„ [Card] Updating card element: cardId=7577664567564831947, elementId=md_12518990, sequence=5, contentLength=411
[OKR] Response complete (length=411)
[FeishuMention] Response generated (length=411): "æˆ‘æ¥å¸®ä½ æŸ¥çœ‹DPA team analytics engineerçš„OKRæƒ…å†µã€‚è®©æˆ‘å…ˆè·å–ç›¸å…³æ•°æ®ã€‚..."
[FeishuMention] Finalizing card with suggestions. cardId=7577664567564831947, result length=411
ğŸ¯ [CardSuggestions] Finalizing card with follow-ups: cardId=7577664567564831947, contentLength=411
ğŸ¯ [CardSuggestions] Generating follow-up suggestions...
ğŸ”„ [Followups] Generating 3 follow-up questions for response: "æˆ‘æ¥å¸®ä½ æŸ¥çœ‹DPA team analytics engineerçš„OKRæƒ…å†µã€‚è®©æˆ‘å…ˆè·å–ç›¸å…³æ•°æ®ã€‚..."
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ”„ [Followups] LLM raw response (first 300 chars): "[
  {"text": "èƒ½å¦æä¾›è¯¥å·¥ç¨‹å¸ˆçš„å…·ä½“å§“åæˆ–å·¥å·ï¼Ÿ", "type": "question"},
  {"text": "å»ºè®®è”ç³»DPAå›¢é˜Ÿè´Ÿè´£äººç¡®è®¤OKRå½•å…¥çŠ¶æ€", "type": "recommendation"},
  {"text": "æ£€æŸ¥ç³»ç»Ÿæƒé™è®¾ç½®ä»¥è·å–å›¢é˜Ÿæ•°æ®è®¿é—®æƒé™", "type": "action"}
]..."
ğŸ”„ [Followups] Extracted JSON (first 200 chars): "[
  {"text": "èƒ½å¦æä¾›è¯¥å·¥ç¨‹å¸ˆçš„å…·ä½“å§“åæˆ–å·¥å·ï¼Ÿ", "type": "question"},
  {"text": "å»ºè®®è”ç³»DPAå›¢é˜Ÿè´Ÿè´£äººç¡®è®¤OKRå½•å…¥çŠ¶æ€", "type": "recommendation"},
  {"text": "æ£€æŸ¥ç³»ç»Ÿæƒé™è®¾ç½®ä»¥è·å–å›¢é˜Ÿæ•°æ®è®¿é—®æƒé™", "type": "action"}
]..."
âœ… [Followups] Generated 3 follow-up options with metadata
ğŸ¯ [CardSuggestions] generateFollowupQuestions returned 3 followups
ğŸ¯ [CardSuggestions] Generated 3 follow-up suggestions (will show as buttons)
ğŸ¯ [CardSuggestions] Disabling streaming mode...
âœ… [CardSuggestions] Streaming mode disabled (card content: response only, no duplicate suggestions)
ğŸ”˜ [CardSuggestions] Sending buttons in separate message (Hypothesis 1)...
ğŸ”˜ [FollowupButtons] Sending 3 buttons in separate message...
ğŸ”˜ [FollowupButtons] Creating card via CardKit...
ğŸ”˜ [FollowupButtons] Card created: 7577664646888377572
ğŸ”˜ [FollowupButtons] Sending as thread reply to rootId=om_x100b5da006fae498c29cc979b52659e...
ğŸ”˜ [FollowupButtons] API response: {
  "code": 0,
  "data": {
    "body": {
      "content": "{\"title\":\"Suggestions\",\"elements\":[[{\"tag\":\"img\",\"image_key\":\"img_v3_02ad_e19fca1f-912a-450e-95de-3c229091b53g\"},{\"tag\":\"text\",\"text\":\"è¯·å‡çº§è‡³æœ€æ–°ç‰ˆæœ¬å®¢æˆ·ç«¯ï¼Œä»¥æŸ¥çœ‹å†…å®¹\"},{\"tag\":\"text\",\"text\":\"\"}]]}"
    },
    "chat_id": "oc_cd4b98905e12ec0cb68adc529440e623",
    "create_time": "1764312538254",
    "deleted": false,
    "message_id": "om_x100b5da0136d08a4c3270849907596e",
    "msg_type": "interactive",
    "parent_id": "om...
ğŸ”˜ [FollowupButtons] isSuccess=true, code=0, has message_id=true
âœ… [FollowupButtons] Successfully sent buttons message: om_x100b5da0136d08a4c3270849907596e
âœ… [CardSuggestions] Buttons sent in separate message: om_x100b5da0136d08a4c3270849907596e
[FeishuMention] Card finalized with suggestions (buttons: om_x100b5da0136d08a4c3270849907596e)
