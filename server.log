[info]: [ "client ready" ]
ğŸ”§ AI SDK Devtools: Enabled with enhanced features
   - StreamInterceptor support
   - Token usage tracking
   - Session grouping
âœ… [Memory] Connected to Supabase database
[info]: [ "event-dispatch is ready" ]
ğŸ”§ Devtools available at: http://localhost:3000/devtools
ğŸ“‹ [Startup] Starting server initialization... (2025-11-28T07:51:34.985Z)
ğŸ“‹ [Startup] Step 0: Initializing Mastra Memory (async in background)...
âœ… [Memory] Connected to PostgreSQL storage (Mastra)
ğŸ“‹ [Startup] Mode: Subscription (WebSocket)
ğŸ“‹ [Startup] Step 1: Initializing WebSocket connection...
[info]: [ "[ws]", "receive events or callbacks through persistent connection only available in self-build & Feishu app, Configured in:\n        Developer Console(å¼€å‘è€…åå°) \n          ->\n        Events and Callbacks(äº‹ä»¶ä¸å›è°ƒ)\n          -> \n        Mode of event/callback subscription(è®¢é˜…æ–¹å¼)\n          -> \n        Receive events/callbacks through persistent connection(ä½¿ç”¨ é•¿è¿æ¥ æ¥æ”¶äº‹ä»¶/å›è°ƒ)" ]
ğŸ“‹ [Startup] Step 2: Starting HTTP server...
âœ… [Startup] Step 2: HTTP server started on port 3000
âœ¨ [Startup] Server is ready to accept requests in 9ms
ğŸ“Š [Startup] Health check: curl http://localhost:3000/health
ğŸ”§ Devtools API: http://localhost:3000/devtools/api/events
ğŸ”§ Devtools Sessions: http://localhost:3000/devtools/api/sessions
ğŸ”§ Devtools Stats: http://localhost:3000/devtools/api/stats
âœ… [Memory] Mastra memory system initialized
âœ… [Startup] Step 1: WebSocket connection established
ğŸ“‹ [Startup] Ready to receive Feishu events
âœ… [Startup] Step 0: Mastra Memory initialized
[info]: [ "[ws]", "ws client ready" ]
ğŸ“¨ [WebSocket] Event received: im.message.receive_v1
ğŸ“¨ [WebSocket] Event data: {
  "schema": "2.0",
  "event_id": "139902063e60b7333976bd891e28ebe9",
  "token": "",
  "create_time": "1764316427360",
  "event_type": "im.message.receive_v1",
  "tenant_key": "2de1f662118f575d",
  "app_id": "cli_a6af6b76c6f0d013",
  "message": {
    "chat_id": "oc_cd4b98905e12ec0cb68adc529440e623",
    "chat_type": "group",
    "content": "{\"text\":\"@_user_1 u there\"}",
    "create_time": "1764316427035",
    "mentions": [
      {
        "id": {
          "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
          "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
          "user_id": ""
        },
        "key": "@_user_1",
        "name": "Evi",
        "tenant_key": "2de1f662118f575d"
      }
    ],
    "message_id": "om_x100b5da11e632c80c398bfb6966c904",
    "message_type": "text",
    "update_time": "1764316427130"
  },
  "sender": {
    "sender_id": {
      "open_id": "ou_db4d1d08c4fcd3f1f4c253eab32ff580",
      "union_id": "on_80d62273b85f0904e27382a59cc1f730",
      "user_id": "xiaofei.yin"
    },
    "sender_type": "user",
    "tenant_key": "2de1f662118f575d"
  }
}
ğŸ¤– [WebSocket] Bot User ID: cli_a6af6b76c6f0d013
ğŸ‘¤ [Auth] Extracted user ID: ou_db4d1d08c4fcd3f1f4c253eab32ff580
ğŸ“© [WebSocket] Message details: chatId=oc_cd4b98905e12ec0cb68adc529440e623, messageId=om_x100b5da11e632c80c398bfb6966c904, chatType=group
ğŸ” [WebSocket] Mentions array: [
  {
    "id": {
      "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
      "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
      "user_id": ""
    },
    "key": "@_user_1",
    "name": "Evi",
    "tenant_key": "2de1f662118f575d"
  }
]
ğŸ“Œ [WebSocket] Extracted mentioned user ID: ou_b996baaafd4fd8f41d219ec7ad2af324 (Evi)
ğŸ” [WebSocket] Found 1 user mention(s) in group (not bot mention)
âš ï¸ [WebSocket] Message ignored (not p2p, not mention, not thread reply)
ğŸ“¨ [WebSocket] Event received: im.message.receive_v1
ğŸ“¨ [WebSocket] Event data: {
  "schema": "2.0",
  "event_id": "b6247ec448a9e8cd79dea673fad3e479",
  "token": "",
  "create_time": "1764312964818",
  "event_type": "im.message.receive_v1",
  "tenant_key": "2de1f662118f575d",
  "app_id": "cli_a6af6b76c6f0d013",
  "message": {
    "chat_id": "oc_cd4b98905e12ec0cb68adc529440e623",
    "chat_type": "group",
    "content": "{\"text\":\"@_user_1 @_user_2 æ˜¯DPA team çš„ä¸€æšanalytics engineerï¼š è´Ÿè´£æ•´ä¸ªdata stack(i.e. dbt â”dagster â” bi dashboard etc.)\\nä½ æœ‰ä»–çš„OKRå—\"}",
    "create_time": "1764312964470",
    "mentions": [
      {
        "id": {
          "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
          "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
          "user_id": ""
        },
        "key": "@_user_1",
        "name": "Evi",
        "tenant_key": "2de1f662118f575d"
      },
      {
        "id": {
          "open_id": "ou_a6f7929ae2b9aa185c375b14d19b4a22",
          "union_id": "on_fa474c31e356ff2b1b8d76c2b453f886",
          "user_id": "angus.zhan"
        },
        "key": "@_user_2",
        "name": "Angus ZHAN è©¹ä¼Ÿç¿€",
        "tenant_key": "2de1f662118f575d"
      }
    ],
    "message_id": "om_x100b5da03688f0a0c2f0a0d934b6979",
    "message_type": "text",
    "parent_id": "om_x100b5db4fd4a6c80c4427c8274336f7",
    "root_id": "om_x100b5db4fd4a6c80c4427c8274336f7",
    "thread_id": "omt_1a4d83f1580d1be8",
    "update_time": "1764312964559"
  },
  "sender": {
    "sender_id": {
      "open_id": "ou_db4d1d08c4fcd3f1f4c253eab32ff580",
      "union_id": "on_80d62273b85f0904e27382a59cc1f730",
      "user_id": "xiaofei.yin"
    },
    "sender_type": "user",
    "tenant_key": "2de1f662118f575d"
  }
}
ğŸ¤– [WebSocket] Bot User ID: cli_a6af6b76c6f0d013
ğŸ‘¤ [Auth] Extracted user ID: ou_db4d1d08c4fcd3f1f4c253eab32ff580
ğŸ“© [WebSocket] Message details: chatId=oc_cd4b98905e12ec0cb68adc529440e623, messageId=om_x100b5da03688f0a0c2f0a0d934b6979, chatType=group
ğŸ” [WebSocket] Mentions array: [
  {
    "id": {
      "open_id": "ou_b996baaafd4fd8f41d219ec7ad2af324",
      "union_id": "on_cb96bf8f32689f8c0b7415ad3a6b6d4e",
      "user_id": ""
    },
    "key": "@_user_1",
    "name": "Evi",
    "tenant_key": "2de1f662118f575d"
  },
  {
    "id": {
      "open_id": "ou_a6f7929ae2b9aa185c375b14d19b4a22",
      "union_id": "on_fa474c31e356ff2b1b8d76c2b453f886",
      "user_id": "angus.zhan"
    },
    "key": "@_user_2",
    "name": "Angus ZHAN è©¹ä¼Ÿç¿€",
    "tenant_key": "2de1f662118f575d"
  }
]
ğŸ“Œ [WebSocket] Extracted mentioned user ID: ou_b996baaafd4fd8f41d219ec7ad2af324 (Evi)
ğŸ” [WebSocket] Found 2 user mention(s) in group (not bot mention)
ğŸ§µ [WebSocket] Processing thread reply: "@_user_1 @_user_2 æ˜¯DPA team çš„ä¸€æšanalytics engineerï¼š..."
Handling new message: oc_cd4b98905e12ec0cb68adc529440e623 om_x100b5db4fd4a6c80c4427c8274336f7
ğŸ“¤ [Card] Creating and sending streaming card to chat_id:oc_cd4b98905e12ec0cb68adc529440e623
âœ… [Card] Created streaming card: cardId=7577683335523208416, elementId=md_16888350
ğŸ“¨ [Card] Sending card message with cardId: 7577683335523208416
ğŸ“¨ [Card] Sending as thread reply to message: om_x100b5db4fd4a6c80c4427c8274336f7
âœ… [Card] Card sent successfully: messageId=om_x100b5da1235c18a4c2ddeb283a6ccb3, cardId=7577683335523208416
âŒ Failed to fetch thread after 1 attempt: Thread fetch timeout after 5000ms
âš ï¸ Proceeding with empty thread context (falling back to current message only)
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
ğŸ¤– [Model] Using fallback model: Google Gemini 2.5 Flash (Paid (reliable, no rate limits))
[Manager] Received query: "[non-text message]"
[Devtools] agent_call: {
  agent: "Manager",
  tool: undefined,
  duration: undefined,
  error: undefined,
}
[Manager] Starting stream for query: "[non-text message]" with primary model
[Manager] Memory context: conversationId=feishu:oc_cd4b98905e12ec0cb68adc529440e623:om_x100b5db4fd4a6c80c4427c8274336f7, userId=user:ou_db4d1d08c4fcd3f1f4c253eab32ff580, feishuUserId=fe8c0c28-642e-531f-9964-fea2edd66a8f, externalFeishuId=ou_db4d1d08c4fcd3f1f4c253eab32ff580
[Manager] Stream created, starting to read textStream...
[Manager] fullStream part 1: {
  "type": "start"
}
14 |   constructor({
15 |     name: name14,
16 |     message,
17 |     cause
18 |   }) {
19 |     super(message);
         ^
AI_InvalidPromptError: Invalid prompt: messages must not be empty
      cause: undefined,
     prompt: {
  system: "<system_context>\nYou are part of a multi-agent system called AI SDK Agents, designed to make agent coordination and execution easy. This system uses two primary abstractions: **Agents** and **Handoffs**. An agent encompasses instructions and tools and can hand off a conversation to another agent when appropriate. Handoffs are achieved by calling a handoff function, generally named `handoff_to_agent`. Transfers between agents are handled seamlessly in the background; do not mention or draw attention to these transfers in your conversation with the user.\n</system_context>\n\n<tool_calling_guidelines>\nWhen you need to call multiple tools, call them ALL at once using parallel tool calling.\n</tool_calling_guidelines>\n\nYou are a Feishu/Lark AI assistant that routes queries to specialist agents. Most user queries will be in Chinese (ä¸­æ–‡).\n\nè·¯ç”±è§„åˆ™ï¼ˆæŒ‰ä»¥ä¸‹é¡ºåºåº”ç”¨ï¼‰ï¼š\n1. OKR Reviewer: è·¯ç”±å…³äºOKRã€ç›®æ ‡ã€å…³é”®ç»“æœã€ç»ç†è¯„å®¡ã€æŒ‡æ ‡è¦†ç›–ç‡(has_metric percentage)ã€è¦†ç›–ç‡(è¦†ç›–ç‡)çš„æŸ¥è¯¢\n2. Alignment Agent: è·¯ç”±å…³äºå¯¹é½(alignment)ã€å¯¹é½ã€ç›®æ ‡å¯¹é½çš„æŸ¥è¯¢\n3. P&L Agent: è·¯ç”±å…³äºæŸç›Š(profit & loss)ã€P&Lã€æŸç›Šã€åˆ©æ¶¦ã€äºæŸã€EBITçš„æŸ¥è¯¢\n4. DPA PM Agent: è·¯ç”±å…³äºDPAã€æ•°æ®å›¢é˜Ÿ(data team)ã€AEã€DAçš„æŸ¥è¯¢\n5. Fallback: å¦‚æœæ²¡æœ‰åŒ¹é…çš„ä¸“å®¶ï¼Œä½¿ç”¨ç½‘ç»œæœç´¢(searchWebå·¥å…·)æˆ–æä¾›æœ‰ç”¨çš„æŒ‡å¯¼\n\nROUTING RULES (apply in this order):\n1. OKR Reviewer: Route queries about OKR, objectives, key results, manager reviews, has_metric percentage, or è¦†ç›–ç‡\n2. Alignment Agent: Route queries about alignment, å¯¹é½, or ç›®æ ‡å¯¹é½\n3. P&L Agent: Route queries about profit & loss, P&L, æŸç›Š, åˆ©æ¶¦, äºæŸ, or EBIT\n4. DPA PM Agent: Route queries about DPA, data team, AE, or DA\n5. Fallback: If no specialist matches, use web search (searchWeb tool) or provide helpful guidance\n\nGENERAL GUIDELINES:\n- Do not tag users. ä¸è¦@ç”¨æˆ·ã€‚\n- Current date is: 2025-11-28\n- Format your responses using Markdown syntax (Lark Markdown format), which will be rendered in Feishu cards.\n- Always route to the most appropriate specialist agent when their domain is mentioned.\n- Use web search for general queries that don't match any specialist.\n- Most queries will be in Chinese - understand Chinese query semantics for better routing.\n\nAVAILABLE SPECIALISTS:\n- OKR Reviewer (okr_reviewer): For OKR metrics, manager reviews, has_metric percentage analysis / ç”¨äºOKRæŒ‡æ ‡ã€ç»ç†è¯„å®¡ã€æŒ‡æ ‡è¦†ç›–ç‡åˆ†æ\n- Alignment Agent (alignment_agent): For alignment tracking (under development) / ç”¨äºå¯¹é½è·Ÿè¸ªï¼ˆå¼€å‘ä¸­ï¼‰\n- P&L Agent (pnl_agent): For profit & loss analysis (under development) / ç”¨äºæŸç›Šåˆ†æï¼ˆå¼€å‘ä¸­ï¼‰\n- DPA PM Agent (dpa_pm): For product management tasks (under development) / ç”¨äºäº§å“ç®¡ç†ä»»åŠ¡ï¼ˆå¼€å‘ä¸­ï¼‰\n\n## Working Memory\n\nYou have access to persistent working memory that stores user preferences, context, and important facts across conversations.\n\n**ALWAYS call updateWorkingMemory when:**\n- User shares OR corrects their name, role, company, or preferences\n- User provides OR updates important facts you should remember\n- User corrects previous information about themselves\n- Any new or changed context that should persist for future conversations\n\n**Template structure to follow:**\n```\n# Working Memory\n\n## Key Facts\n- [Important information goes here]\n\n## Current Focus\n- [What the user is working on]\n\n## Preferences\n- [User preferences and settings]\n\n```\n\n**Critical:** After calling updateWorkingMemory, respond to the user confirming the update.",
  prompt: undefined,
  messages: [],
},
 vercel.ai.error: true,
 vercel.ai.error.AI_InvalidPromptError: true,

      at new _AISDKError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/node_modules/@ai-sdk/provider/dist/index.mjs:19:5)

[Manager] fullStream part 2: {
  "type": "error",
  "error": {
    "name": "AI_InvalidPromptError",
    "prompt": {
      "system": "<system_context>\nYou are part of a multi-agent system called AI SDK Agents, designed to make ag
[Manager] fullStream completed with 2 parts
[Manager] Finished reading textStream. Total chunks: 0, Final text length: 0
[Manager] Final result received: {
  text: "N/A",
  textLength: 0,
  accumulatedLength: 0,
  usage: {
    input: undefined,
    output: undefined,
    total: undefined,
  },
}
[Manager] Query handled directly (no handoff): "[non-text message]"
[Devtools] response: {
  agent: "Manager",
  tool: undefined,
  duration: 49,
  error: undefined,
  tokens: {
    input: undefined,
    output: undefined,
    total: undefined,
  },
}
[Manager] Returning final text (length=0)
ğŸ¯ [CardSuggestions] Finalizing card with follow-ups: cardId=7577683335523208416, contentLength=0
ğŸ¯ [CardSuggestions] Generating follow-up suggestions...
ğŸ”„ [Followups] Generating 3 follow-up questions for response: "..."
ğŸ¤– [Model] Using primary model: kwaipilot/kat-coder-pro (Free tier (may have rate limits))
âŒ [Process] Unhandled Promise Rejection: 14 |   constructor({
15 |     name: name14,
16 |     message,
17 |     cause
18 |   }) {
19 |     super(message);
         ^
AI_NoOutputGeneratedError: No output generated. Check the stream for errors.
      cause: undefined,
 vercel.ai.error: true,
 vercel.ai.error.AI_NoOutputGeneratedError: true,

      at new _AISDKError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/node_modules/@ai-sdk/provider/dist/index.mjs:19:5)
      at new NoOutputGeneratedError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:249:5)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4772:27)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4769:19)

   Promise: Promise { <rejected> }
âŒ [WARN] Unhandled rejection at: Promise { <rejected> } reason: 14 |   constructor({
15 |     name: name14,
16 |     message,
17 |     cause
18 |   }) {
19 |     super(message);
         ^
AI_NoOutputGeneratedError: No output generated. Check the stream for errors.
      cause: undefined,
 vercel.ai.error: true,
 vercel.ai.error.AI_NoOutputGeneratedError: true,

      at new _AISDKError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/node_modules/@ai-sdk/provider/dist/index.mjs:19:5)
      at new NoOutputGeneratedError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:249:5)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4772:27)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4769:19)

âŒ [Process] Unhandled Promise Rejection: 14 |   constructor({
15 |     name: name14,
16 |     message,
17 |     cause
18 |   }) {
19 |     super(message);
         ^
AI_NoOutputGeneratedError: No output generated. Check the stream for errors.
      cause: undefined,
 vercel.ai.error: true,
 vercel.ai.error.AI_NoOutputGeneratedError: true,

      at new _AISDKError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/node_modules/@ai-sdk/provider/dist/index.mjs:19:5)
      at new NoOutputGeneratedError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:249:5)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4772:27)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4769:19)

   Promise: Promise { <rejected> }
âŒ [WARN] Unhandled rejection at: Promise { <rejected> } reason: 14 |   constructor({
15 |     name: name14,
16 |     message,
17 |     cause
18 |   }) {
19 |     super(message);
         ^
AI_NoOutputGeneratedError: No output generated. Check the stream for errors.
      cause: undefined,
 vercel.ai.error: true,
 vercel.ai.error.AI_NoOutputGeneratedError: true,

      at new _AISDKError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/node_modules/@ai-sdk/provider/dist/index.mjs:19:5)
      at new NoOutputGeneratedError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:249:5)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4772:27)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4769:19)

âŒ [Process] Unhandled Promise Rejection: 14 |   constructor({
15 |     name: name14,
16 |     message,
17 |     cause
18 |   }) {
19 |     super(message);
         ^
AI_NoOutputGeneratedError: No output generated. Check the stream for errors.
      cause: undefined,
 vercel.ai.error: true,
 vercel.ai.error.AI_NoOutputGeneratedError: true,

      at new _AISDKError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/node_modules/@ai-sdk/provider/dist/index.mjs:19:5)
      at new NoOutputGeneratedError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:249:5)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4772:27)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4769:19)

   Promise: Promise { <rejected> }
âŒ [WARN] Unhandled rejection at: Promise { <rejected> } reason: 14 |   constructor({
15 |     name: name14,
16 |     message,
17 |     cause
18 |   }) {
19 |     super(message);
         ^
AI_NoOutputGeneratedError: No output generated. Check the stream for errors.
      cause: undefined,
 vercel.ai.error: true,
 vercel.ai.error.AI_NoOutputGeneratedError: true,

      at new _AISDKError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/node_modules/@ai-sdk/provider/dist/index.mjs:19:5)
      at new NoOutputGeneratedError (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:249:5)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4772:27)
      at flush (/Users/xiaofei.yin/work_repo/feishu_assistant/node_modules/ai/dist/index.mjs:4769:19)

ğŸ”„ [Followups] LLM raw response (first 300 chars): "[
  {"text": "èƒ½å¦åˆ†äº«DPAå›¢é˜Ÿçš„æ•°æ®æ¶æ„å›¾ï¼Ÿ", "type": "question"},
  {"text": "å»ºè®®æ¢³ç†å½“å‰dbtæ¨¡å‹çš„æ–‡æ¡£åŒ–æµç¨‹", "type": "recommendation"},
  {"text": "å®‰æ’ä¸DPAå›¢é˜ŸåŒæ­¥OKRå¯¹é½ä¼šè®®", "type": "action"}
]..."
ğŸ”„ [Followups] Extracted JSON (first 200 chars): "[
  {"text": "èƒ½å¦åˆ†äº«DPAå›¢é˜Ÿçš„æ•°æ®æ¶æ„å›¾ï¼Ÿ", "type": "question"},
  {"text": "å»ºè®®æ¢³ç†å½“å‰dbtæ¨¡å‹çš„æ–‡æ¡£åŒ–æµç¨‹", "type": "recommendation"},
  {"text": "å®‰æ’ä¸DPAå›¢é˜ŸåŒæ­¥OKRå¯¹é½ä¼šè®®", "type": "action"}
]..."
âœ… [Followups] Generated 3 follow-up options with metadata
ğŸ¯ [CardSuggestions] generateFollowupQuestions returned 3 followups
ğŸ¯ [CardSuggestions] Generated 3 follow-up suggestions (will show as buttons)
ğŸ¯ [CardSuggestions] Disabling streaming mode...
âœ… [CardSuggestions] Streaming mode disabled (card content: response only, no duplicate suggestions)
ğŸ”˜ [CardSuggestions] Sending buttons in separate message (Hypothesis 1)...
ğŸ”˜ [FollowupButtons] Sending 3 buttons in separate message...
ğŸ”˜ [FollowupButtons] Creating card via CardKit...
ğŸ”˜ [FollowupButtons] Card created: 7577683375081655516
ğŸ”˜ [FollowupButtons] Sending as thread reply to rootId=om_x100b5db4fd4a6c80c4427c8274336f7...
ğŸ”˜ [FollowupButtons] API response: {
  "code": 0,
  "data": {
    "body": {
      "content": "{\"title\":\"Suggestions\",\"elements\":[[{\"tag\":\"img\",\"image_key\":\"img_v3_02ad_e19fca1f-912a-450e-95de-3c229091b53g\"},{\"tag\":\"text\",\"text\":\"è¯·å‡çº§è‡³æœ€æ–°ç‰ˆæœ¬å®¢æˆ·ç«¯ï¼Œä»¥æŸ¥çœ‹å†…å®¹\"},{\"tag\":\"text\",\"text\":\"\"}]]}"
    },
    "chat_id": "oc_cd4b98905e12ec0cb68adc529440e623",
    "create_time": "1764316898629",
    "deleted": false,
    "message_id": "om_x100b5da120eb0ca4c2672f49c4a1f13",
    "msg_type": "interactive",
    "parent_id": "om...
ğŸ”˜ [FollowupButtons] isSuccess=true, code=0, has message_id=true
âœ… [FollowupButtons] Successfully sent buttons message: om_x100b5da120eb0ca4c2672f49c4a1f13
âœ… [CardSuggestions] Buttons sent in separate message: om_x100b5da120eb0ca4c2672f49c4a1f13
[error]: [
  [
    {
      message: "The socket connection was closed unexpectedly. For more information, pass `verbose: true` in the second argument to fetch()",
      config: [Object ...],
      request: [Object ...],
      response: [Object ...],
    }
  ]
]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 2 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 3 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 4 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 5 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 6 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 7 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 8 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 9 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 10 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 11 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 12 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 13 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 2 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 3 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 4 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 5 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[warn]: [ "no im.message.reaction.created_v1 handle" ]
[warn]: [ "no im.message.reaction.created_v1 handle" ]
[warn]: [ "no im.message.reaction.created_v1 handle" ]
[warn]: [ "no im.message.reaction.created_v1 handle" ]
[warn]: [ "no im.message.reaction.created_v1 handle" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 2 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 3 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 4 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 5 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 6 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 7 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 8 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 9 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 10 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 11 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 12 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 13 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 14 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "timeout of 15000ms exceeded" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[warn]: [ "no im.message.reaction.created_v1 handle" ]
[info]: [ "[ws]", "reconnect" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 1 times\")" ]
[error]: [ "[ws]", "ECONNREFUSED" ]
[info]: [ "ws", "unable to connect to the server after trying 2 times\")" ]
[info]: [ "[ws]", "reconnect" ]
[warn]: [ "no im.message.reaction.created_v1 handle" ]
[warn]: [ "no im.message.reaction.created_v1 handle" ]
ğŸ“¨ [WebSocket] Event received: im.message.receive_v1
ğŸ“¨ [WebSocket] Event data: {
  "schema": "2.0",
  "event_id": "2e5ca35661c4794883807f0ec3aaa0b8",
  "token": "",
  "create_time": "1764661543074",
  "event_type": "im.message.receive_v1",
  "tenant_key": "2de1f662118f575d",
  "app_id": "cli_a6af6b76c6f0d013",
  "message": {
    "chat_id": "oc_c6c0874d4020e0d3b48d1fce2b62656b",
    "chat_type": "group",
    "content": "{\"text\":\"@_all æˆ‘ä»¬çš„è®¢å•è¡¨alps_dwm.onvo_new_car_order_wide_1h_fè¦å’Œnioçš„åˆå¹¶ï¼Œè‚¯å®šä¼šæ¶‰åŠåˆ°è¡¨è¿ç§»çš„å·¨å¤§å·¥ä½œé‡ï¼Œå¤§å®¶æœ‰æ²¡æœ‰ä¸€äº›é‡è¦çš„éœ€æ±‚æœŸæœ›ä¹‹ç±»çš„\"}",
    "create_time": "1764661542649",
    "message_id": "om_x100b5ddddcaa58b0b36f800525bdd1d",
    "message_type": "text",
    "update_time": "1764661542649"
  },
  "sender": {
    "sender_id": {
      "open_id": "ou_91dfc9902c715b29bd491c9be06f1e35",
      "union_id": "on_7367b05dd2ab71aa6dd4fe684349ec0b",
      "user_id": "jayden.liu"
    },
    "sender_type": "user",
    "tenant_key": "2de1f662118f575d"
  }
}
ğŸ¤– [WebSocket] Bot User ID: cli_a6af6b76c6f0d013
ğŸ‘¤ [Auth] Extracted user ID: ou_91dfc9902c715b29bd491c9be06f1e35
ğŸ“© [WebSocket] Message details: chatId=oc_c6c0874d4020e0d3b48d1fce2b62656b, messageId=om_x100b5ddddcaa58b0b36f800525bdd1d, chatType=group
ğŸ” [WebSocket] Mentions array: []
âš ï¸ [WebSocket] Message ignored (not p2p, not mention, not thread reply)
[warn]: [ "no im.message.reaction.created_v1 handle" ]
